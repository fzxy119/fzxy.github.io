<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>别来无恙</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="别来无恙">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="别来无恙">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="晓">
<meta property="article:tag" content="java 软件工程 hexo 笔记 晓">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="别来无恙" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">别来无恙</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">晓</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about/me">关于</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-softwareeng/DDD" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/26/softwareeng/DDD/" class="article-date">
  <time class="dt-published" datetime="2023-11-26T06:50:55.000Z" itemprop="datePublished">2023-11-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">软件工程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/26/softwareeng/DDD/">保持模型的完整性</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="界限上下文之间的集成策略（界限上下文之间的关系）"><a href="#界限上下文之间的集成策略（界限上下文之间的关系）" class="headerlink" title="界限上下文之间的集成策略（界限上下文之间的关系）"></a>界限上下文之间的集成策略（界限上下文之间的关系）</h2><p>限界上下文定义领域边界，以确保每个上下文含义在它特定的边界内都具有唯一的含义，领域模型则存在于这个边界之内。<br>不同的上下文之间出现相同含义的领域模型该如何保持每个上下文中的模型完整？新系统与老系统之间的集成该如何保证模型的完成？多个子系统集成该用那种策略？</p>
<h3 id="1-共享内核模式-Shared-Kernel"><a href="#1-共享内核模式-Shared-Kernel" class="headerlink" title="1. 共享内核模式(Shared Kernel)"></a>1. 共享内核模式(Shared Kernel)</h3><p>   提高服用能力，减少持续集成和模型转换所带来的开销，是共享内核模式主要目的</p>
<p>   当不同的团队开发一些紧密相关的应用程序时，如果团队之间不进行协调，即使短时间内能够有快速的进展，但是他们开发出来的产品可能也无法结合到一起，最后可能不得不耗费大量精力进行模型转换，这也是持续集成的必要性。</p>
<p>   在很多项目中，不同的团队能够共享基础设施，领域工作也可以采用类似的方式，以得到很好的效果。因为保持模型和代码的完全同步的开销可能太高了，但从系统中仔细挑选出一部分保持同步，就能以较小的代价获得较大的收益。</p>
<p>   因此<br>   从领域模型中挑选出两个团队都同意共享的子集，除了模型还有代码子集，数据库设计子集，来作为共享的基础设施，这部分明确共享的内容具有特殊的地位，团队之间如果没有商量好的情况下事不应擅自更改。<br>   这要求两个团队之间需要紧密的合作关系</p>
<h3 id="2-客户供应商模式（Customer-Supplier）"><a href="#2-客户供应商模式（Customer-Supplier）" class="headerlink" title="2. 客户供应商模式（Customer/Supplier）"></a>2. 客户供应商模式（Customer/Supplier）</h3><p>   明确客户供应商关系是关键</p>
<p>   在很多项目中，如果下游团队对比变更具有否决权，或请求并更的程序爱太复杂，那么上游团队的开发自由度就会很受限制。由于担心破坏下系统，上游团队甚至会受到抑制。同时由于上游团队掌握优先权，下游团队有时候也无能为力。（下游团队依赖上游团队，但是上游团队却不负责下游团队的产品交付）</p>
<p>   因此<br>   在两个团队之间建立一个明确的客户供应商关系，在计划会议中，下游团队相当于上游团队的客户。根据下游团队的需求来协商需要执行的任务。<br>   两个团队需要归属于同一个管理者指挥</p>
<h3 id="3-追随者模式（Conformist）"><a href="#3-追随者模式（Conformist）" class="headerlink" title="3. 追随者模式（Conformist）"></a>3. 追随者模式（Conformist）</h3><p>   当两个团队并不归属于同一管理者指挥，两个团队在管理层次中相各很远，或者主管不关心两个团队之间的关系，客户供应商模式将无法达到其效果。<br>   也许上游团队成员做出承诺，但他们可能不会履行承诺。下游团队项目只能被搁置，直到最终学会利用现有条件自力更生。</p>
<p>   有三种解决途径<br>   1). 完全放弃上游，<br>       做这种选择时候，绝不要假定上游会满足下游系统需求，有时候我们会高估这种依赖的价值，低估他的成本。<br>   2). 上游模型设计难用，自行设计模型，并负责模型转换<br>   3). 上游设计质量不是很差，而且风格也能兼容，最好不要再次开发独立模型，可采用追随者模式</p>
<p>   因此<br>   通过严格遵从上游团队的模型，可以消除在上下文之间进行转换的复杂性，尽管这会限制下游设计人员的风格，而且不会得到很理想的模型，但他简化了集成。</p>
<h3 id="4-防腐层模式（Anti-corruption-layer）"><a href="#4-防腐层模式（Anti-corruption-layer）" class="headerlink" title="4. 防腐层模式（Anti-corruption layer）"></a>4. 防腐层模式（Anti-corruption layer）</h3><p>   新系统集成遗留系统或与其他系统集成，这些系统都有自己的模型，当把参与集成的界限上下文实际完善并且团队相互合作时，转换层可能很简单，甚至很优雅。而且当边界那侧发生渗透<br>   时，转换层就要承担起更多的防护职责。</p>
<blockquote>
<p>①遗留系统模型偏弱，②模型转换简单，③团队相互配合，防腐层还有防止模型侵入的优点</p>
</blockquote>
<p>   因此<br>   创建一个隔离层，以便根据客户自己的领域模型为客户相关功能，这个层通过另一个系统现有接口与其进行对话，而只需要对那个系统做出少量修改甚至无需修改。在内部这个层在两个模型之间进行必要的双向转换。</p>
<p>   实现：门面模式（Facade） 适配器模式(Adapter)</p>
<h3 id="5-开放主机模式-（OPENHOST）"><a href="#5-开放主机模式-（OPENHOST）" class="headerlink" title="5. 开放主机模式 （OPENHOST）"></a>5. 开放主机模式 （OPENHOST）</h3><p>   一次性集成可以采用防腐层的方式开发对应的模型转换，但是当遇到子系统要与大量的其他系统集成的时候，为每个集成都定制一个转换层可能会减慢团队的工作进度。<br>   团队可能正在反复坐着同样的事情，如果一个子系统有某种内聚性，那么或者可以把他描述为一组Service,这组Service满足了其他子系统的公共需求。</p>
<p>   因此<br>   定义一个协议，把子系统作为一组service供其他系统访问（可通过某种配置定位服务），开放协议，以便所有需要与你的子系统集成的人都可以使用它。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/26/softwareeng/DDD/" data-id="clpfb6uhn0022toqwee0m4ie5" data-title="保持模型的完整性" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DDD/" rel="tag">DDD</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-软件开发方法之RUP" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/25/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95%E4%B9%8BRUP/" class="article-date">
  <time class="dt-published" datetime="2023-11-25T10:31:18.285Z" itemprop="datePublished">2023-11-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">软件工程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/25/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95%E4%B9%8BRUP/">软件过程模型之RUP</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp; RUP (Rational Unified Process).Rational 公司提出的统一软件过程，Unified 说RUP是最佳开发经验总结，Process说明 RUP是一个软件开发过程。</p>
<p>软件的生命周期：</p>
<p>&emsp;&emsp; 软件的生命周期是一个软件从无到有再到消亡，经过的生命各个阶段，软件的生命周期有通用的生命周期，但是不同的场景，不同的开发方法可能会进行不同的裁剪，一般情况下软件的生命周期有</p>
<ol>
<li>问题定义，</li>
<li>可行性分析，</li>
<li>需求分析，</li>
<li>概要设计，</li>
<li>详细设计，</li>
<li>软件实现，</li>
<li>测试验收部署，</li>
<li>运行与维护，</li>
<li>消亡。</li>
</ol>
<p>&emsp;&emsp;RUP是一种软件过程模型，定义了我们在开发周期内的不同阶段、及在各个阶段内参与的人，从事的活动及产出物，那么这种开发过程的总结是一种经验性方法总结，可以指导我们如何能够明确的、有条不紊、高效的软件开发。</p>
<h3 id="RUP将软件开发周期了四个阶段："><a href="#RUP将软件开发周期了四个阶段：" class="headerlink" title="RUP将软件开发周期了四个阶段："></a>RUP将软件开发周期了四个阶段：</h3><blockquote>
<p>1.初始化阶段：定义最终产品视图和业务模型，并确定系统范围</p>
</blockquote>
<blockquote>
<p>2.细化阶段：设计及确定系统的体系结构，确定工作计划及资源要求。</p>
</blockquote>
<blockquote>
<p>3.构建阶段：构造产品并继续演进需求，体系结构，计划直至产品提交。</p>
</blockquote>
<blockquote>
<p>4.交付阶段：把产品交付给用户使用</p>
</blockquote>
<p><em>RUP定义的4个过程组成了一个周期，那么在整个软件开发过程中，RUP的4个过程是一直进行迭代增量的，每次迭代都会演化为产品的下一代产品。直至产品交付和消亡</em></p>
<p>&emsp;&emsp;RUP有三个显著的特点：用例驱动，以系统架构为中心，迭代与增量。他们是RUP解决问题的方式及方法。</p>
<h4 id="初始化阶段"><a href="#初始化阶段" class="headerlink" title="初始化阶段"></a>初始化阶段</h4><p>&emsp;&emsp;初始化阶段他包含了软件生命周期中问题的定义，需求的分析，并完成系统定位及范围，最终生成产品视图、业务模型、及系统范围。此阶段中我们一般从事 RUP中定义的 业务建模活动，需求分析活动，业务建模是理解待开发所在机构及其商业活动运作，确保所有参与人员对待开发系统所在的机构，有共同的认识，待开发系统对所在机构的影响。</p>
<p><strong>&emsp;&emsp;在初始化阶段，必须识别出所有与系统交互的外部实体，定义系统与外部实体交互的特性，在这个阶段中所关注的是整个项目的业务和需求方面的主要风险，对建立在原有系统基础上的开发项目来说，初始化阶段可能很短。</strong></p>
<p>此阶段我们需要完成<br>1：业务流程模型的建立，流程模型可以是文档描述，也可以使用图形表述，无论何种方式使大家能够对业务有一个清醒的统一的认识是主要目的:<br>2：完成系统与外部实体，交互关系图，及交互方式定义。<br>3：完成系统与外部系统职责，及确定系统的范围</p>
<h4 id="细化阶段"><a href="#细化阶段" class="headerlink" title="细化阶段"></a>细化阶段</h4><p>&emsp;&emsp;设计及确定系统的体系结构，确定工作计划及资源要求。软件体系结构刻画了系统的整体结构，它去掉了细节部分，突出了系统的重要特征。<br>软件体系结构的设计与代码设计无关，不依赖于程序设计语言，软件体系结构是软件设计过程中的一个层次，体系结构的设计需要考虑多方面问题。<br>在功能性特征方面要考虑系统的功能，非功能性特征方面要考虑系统性能，安全性和可用性等。<br>软件开发有关的特征需要考虑可修改性，可移植性，可重用性，可集成性，可测试性<br>开发经济学有关的特征需要考虑，开发时间，费用，系统生命周期，</p>
<p>&emsp;&emsp;设对于一个软件系统，不同人员所关心的内容是不一样的，因此软件的体系结构是一个多维的结构，也就是说会采用多个视图来描述软件体系结构。<br>如：对于一座大厦，对于大厦建设和维护人员来说，会用电线布线结构，有些人会用电梯布局结构，有些人会用水管布局结构。</p>
<p>&emsp;&emsp;在RUP总采用4+1 视图模型来描述软件体系结构，用例图，逻辑图，实现图，进程图，部署图。<br>分析人员和测试人员关心的是系统行为，因此会侧重于用例视图，用户关心的是系统功能，会侧重于逻辑视图，程序人员关心的是系统配置和装配问题，侧重于实现视图，<br>系统集成人员关心系统的可伸缩性，吞吐率等问题，因此侧重于进程视图，系统工程师关心系统的发布，安装，拓扑，侧重于部署图。</p>
<p>RUP定义的9中活动：业务建模，需求，分析设计，实现，测试，部署，配置与变更管理，项目管理，环境<br>RUP中的核心概念：角色 Role,活动 Activity 制品 Artifact 工作流 workflow</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/25/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95%E4%B9%8BRUP/" data-id="clpfb6uh80007toqw4w99dr22" data-title="软件过程模型之RUP" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BF%87%E7%A8%8B%E6%A8%A1%E5%9E%8B/" rel="tag">过程模型</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-db/oracl/sqlanalysi" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/08/31/db/oracl/sqlanalysi/" class="article-date">
  <time class="dt-published" datetime="2022-08-31T06:11:21.000Z" itemprop="datePublished">2022-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DB/">DB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/08/31/db/oracl/sqlanalysi/">ORACLE sql 分析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>EXPLAIN PLAN FOR select * from A_AGENT a where a.ID=’AG20181121000000000011525’;</p>
<p>–SELECT plan_table_output FROM TABLE(DBMS_XPLAN.DISPLAY(‘PLAN_TABLE’));</p>
<p>select * from table(dbms_xplan.display);</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/08/31/db/oracl/sqlanalysi/" data-id="clpfb6uhv003ftoqw62zu4k8r" data-title="ORACLE sql 分析" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-java/arthas" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/08/26/java/arthas/" class="article-date">
  <time class="dt-published" datetime="2022-08-26T09:09:06.000Z" itemprop="datePublished">2022-08-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tc/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/08/26/java/arthas/">vmtoll</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>7490376  Approved<br>sc -d org.springframework.context.ApplicationContext<br>–线上执行代码</p>
<p>vmtool –action getInstances -c  6981e5e3 –className org.springframework.context.ApplicationContext –express ‘instances[1].getBean(“snReturnService”).approveReject(“5020059”)’</p>
<p>vmtool –action getInstances -c 2f9cd665 –className org.springframework.context.ApplicationContext –express ‘instances[1].getBean(“orderAdjustService”).approveFinishOrderAdjust(“4922565”,”reject_end”)’</p>
<p>vmtool –action getInstances -c 5950a341 –className org.springframework.context.ApplicationContext –express ‘instances[1].getBean(“activityService”).single(“snreturn_single_reject”,”4735433”)’</p>
<p>vmtool –action getInstances -c 5950a341 –className org.springframework.context.ApplicationContext –express ‘instances[1].getBean(“kfkCallBackEnterService”).dealMsg(“KM210317001134012”,”3”,”解冻完成”)’</p>
<p>vmtool –action getInstances -c 5950a341 –className org.springframework.context.ApplicationContext –express ‘instances[1].getBean(“agentContractService”).queryRedisAgContractFreeze()’</p>
<p>vmtool –action getInstances -c 2f9cd665 –className org.springframework.context.ApplicationContext –express ‘instances[1].getBean(“dataChangeActivityService”).compressColInfoDataChangeActivity(“4877809”,”Approved”)’</p>
<p>vmtool –action getInstances -c   2af28f0e –className org.springframework.context.ApplicationContext –express ‘#arr = new java.util.ArrayList&lt;java.lang.String&gt;(), #arr.add(“5020059”), instances[1].getBean(“activityService”).deleteInstance(#arr)’</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/08/26/java/arthas/" data-id="clpfb6uhi001ftoqw7hdr2crv" data-title="vmtoll" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arthas/" rel="tag">arthas</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-db/mysql" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/26/db/mysql/" class="article-date">
  <time class="dt-published" datetime="2022-07-26T09:53:21.000Z" itemprop="datePublished">2022-07-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DB/">DB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/26/db/mysql/">Mysql数据类型</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="数字类型"><a href="#数字类型" class="headerlink" title="数字类型"></a>数字类型</h1><img src="/2022/07/26/db/mysql/mysqlint.png" class="" title="jvmmap">

<p>在整型类型中，有 signed 和 unsigned 属性，其表示的是整型的取值范围，默认为 signed</p>
<h2 id="浮点类型-高精度"><a href="#浮点类型-高精度" class="headerlink" title="浮点类型 高精度"></a>浮点类型 高精度</h2><ul>
<li>浮点类型  Float 和 Double</li>
</ul>
<p>MySQL 之前的版本中存在浮点类型 Float 和 Double，但这些类型因为不是高精度，也不是 SQL 标准的类型，所以在真实的生产环境中不推荐使用</p>
<ul>
<li>高精度类型 DECIMAL(8,2)</li>
</ul>
<blockquote>
<p>整形类型与自增</p>
<blockquote>
<p>用 BIGINT 做主键，而不是 INT<br>自增值并不持久化，可能会有回溯现象（MySQL 8.0 版本前）,MySQL 8.0 版本前，自增不持久化，自增值可能会存在回溯问题<br>资金类字段设计 建议采用BIG INT（8字节定长）,以分为单位</p>
</blockquote>
</blockquote>
<h1 id="字符类型"><a href="#字符类型" class="headerlink" title="字符类型"></a>字符类型</h1><p>MySQL 数据库的字符串类型有 CHAR、VARCHAR、BINARY、BLOB、TEXT、ENUM、SET。不同的类型在业务设计、数据库性能方面的表现完全不同，其中最常使用的是 CHAR、VARCHAR</p>
<p>CHAR(N) 用来保存固定长度的字符，N 的范围是 0 ~ 255，请牢记，N 表示的是字符，而不是字节。</p>
<p>VARCHAR(N) 用来保存变长字符，N 的范围为 0 ~ 65536， N 表示字符。</p>
<p>在超出 65536 个字符的情况下，可以考虑使用更大的字符类型 TEXT 或 BLOB，两者最大存储长度为 4G，其区别是 BLOB 没有字符集属性，纯属二进制存储</p>
<p>和 Oracle、Microsoft SQL Server 等传统关系型数据库不同的是，MySQL 数据库的 VARCHAR 字符类型，最大能够存储 65536 个字符，所以在 MySQL 数据库下，绝大部分场景使用类型 VARCHAR 就足够了</p>
<h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><p>在表结构设计中，除了将列定义为 CHAR 和 VARCHAR 用以存储字符以外，还需要额外定义字符对应的字符集，因为每种字符在不同字符集编码下，对应着不同的二进制值。常见的字符集有 GBK、UTF8，通常推荐把默认字符集设置为 UTF8</p>
<p>而且随着移动互联网的飞速发展，推荐把 MySQL 的默认字符集设置为 UTF8MB4,否则，某些 emoji 表情字符无法在 UTF8 字符集下存储，比如 emoji 笑脸表情，对应的字符编码为 0xF09F988E</p>
<p>包括 MySQL 8.0 版本在内，字符集默认设置成 UTF8MB4，8.0 版本之前默认的字符集为 Latin1。因为不同版本默认字符集的不同，你要显式地在配置文件中进行相关参数的配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">character-set-server = utf8mb4</span><br></pre></td></tr></table></figure>

<p>另外，不同的字符集，CHAR(N)、VARCHAR(N) 对应最长的字节也不相同。比如 GBK 字符集，1 个字符最大存储 2 个字节，UTF8MB4 字符集 1 个字符最大存储 4 个字节。所以从底层存储内核看，在多字节字符集下，CHAR 和 VARCHAR 底层的实现完全相同，都是变长存储</p>
<ul>
<li>正确设置字符集</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE emoji_test CHARSET utf8mb4;</span><br><span class="line">mysql&gt; ALTER TABLE emoji_test CONVERT TO CHARSET utf8mb4;</span><br></pre></td></tr></table></figure>

<h2 id="排序规则"><a href="#排序规则" class="headerlink" title="排序规则"></a>排序规则</h2><p>排序规则（Collation）是比较和排序字符串的一种规则，每个字符集都会有默认的排序规则，你可以用命令 SHOW CHARSET 来查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW CHARSET LIKE &#x27;utf8%&#x27;;</span><br><span class="line"></span><br><span class="line">+---------+---------------+--------------------+--------+</span><br><span class="line"></span><br><span class="line">| Charset | Description   | Default collation  | Maxlen |</span><br><span class="line"></span><br><span class="line">+---------+---------------+--------------------+--------+</span><br><span class="line"></span><br><span class="line">| utf8    | UTF-8 Unicode | utf8_general_ci    |      3 |</span><br><span class="line"></span><br><span class="line">| utf8mb4 | UTF-8 Unicode | utf8mb4_0900_ai_ci |      4 |</span><br><span class="line"></span><br><span class="line">+---------+---------------+--------------------+--------+</span><br><span class="line"></span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW COLLATION LIKE &#x27;utf8mb4%&#x27;;</span><br><span class="line"></span><br><span class="line">+----------------------------+---------+-----+---------+----------+---------+---------------+</span><br><span class="line"></span><br><span class="line">| Collation                  | Charset | Id  | Default | Compiled | Sortlen | Pad_attribute |</span><br><span class="line"></span><br><span class="line">+----------------------------+---------+-----+---------+----------+---------+---------------+</span><br><span class="line"></span><br><span class="line">| utf8mb4_0900_ai_ci         | utf8mb4 | 255 | Yes     | Yes      |       0 | NO PAD        |</span><br><span class="line"></span><br><span class="line">| utf8mb4_0900_as_ci         | utf8mb4 | 305 |         | Yes      |       0 | NO PAD        |</span><br><span class="line"></span><br><span class="line">| utf8mb4_0900_as_cs         | utf8mb4 | 278 |         | Yes      |       0 | NO PAD        |</span><br><span class="line"></span><br><span class="line">| utf8mb4_0900_bin           | utf8mb4 | 309 |         | Yes      |       1 | NO PAD        |</span><br><span class="line"></span><br><span class="line">| utf8mb4_bin                | utf8mb4 |  46 |         | Yes      |       1 | PAD SPACE     |</span><br></pre></td></tr></table></figure>

<p>排序规则以 _ci 结尾，表示不区分大小写（Case Insentive），_cs 表示大小写敏感，_bin 表示通过存储字符的二进制进行比较。需要注意的是，比较 MySQL 字符串，默认采用不区分大小的排序规则</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/26/db/mysql/" data-id="clpfb6uhf000wtoqw8ajp5stw" data-title="Mysql数据类型" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-db/esbase" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/26/db/esbase/" class="article-date">
  <time class="dt-published" datetime="2022-07-26T06:11:34.000Z" itemprop="datePublished">2022-07-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DB/">DB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/26/db/esbase/">ES基础</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Elasticsearch-是做什么的"><a href="#Elasticsearch-是做什么的" class="headerlink" title="Elasticsearch  是做什么的"></a>Elasticsearch  是做什么的</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;Elasticsearch 是一个实时的分布式搜索分析引擎，它能让你以前所未有的速度和规模，去探索你的数据。 它被用作全文检索、结构化搜索、分析以及这三个功能的组合</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;通常情况下，我们从数据库中提取可用的知识出乎意料的低效，当然，你可以通过时间戳或精确值进行过滤，但是它们能够全文检索、处理同义词、通过相关性给文档评分么？ 它们能从同样的数据中生成分析与聚合数据吗？最重要的是，它们能实时地做到上述操作，而不经过大型批处理的任务么？</p>
<h2 id="Elasticsearch-是用什么实现的"><a href="#Elasticsearch-是用什么实现的" class="headerlink" title="Elasticsearch  是用什么实现的"></a>Elasticsearch  是用什么实现的</h2><p>Elasticsearch 是一个开源的搜索引擎，建立在一个全文搜索引擎库 Apache Lucene™ 基础之上。 Lucene 可以说是当下最先进、高性能、全功能的搜索引擎库—​无论是开源还是私有。</p>
<p>但是 Lucene 仅仅只是一个库。为了充分发挥其功能，你需要使用 Java 并将 Lucene 直接集成到应用程序中。 更糟糕的是，您可能需要获得信息检索学位才能了解其工作原理。Lucene 非常 复杂。</p>
<p>Elasticsearch 也是使用 Java 编写的，它的内部使用 Lucene 做索引与搜索，但是它的目的是使全文检索变得简单， 通过隐藏 Lucene 的复杂性，取而代之的提供一套简单一致的 RESTful API。</p>
<p>然而，Elasticsearch 不仅仅是 Lucene，并且也不仅仅只是一个全文搜索引擎。 它可以被下面这样准确的形容：</p>
<ul>
<li>一个分布式的实时文档存储，每个字段 可以被索引与搜索</li>
<li>一个分布式实时分析搜索引擎</li>
<li>能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据</li>
</ul>
<p>Elasticsearch 将所有的功能打包成一个单独的服务，这样你可以通过程序与它提供的简单的 RESTful API 进行通信， 可以使用自己喜欢的编程语言充当 web 客户端，甚至可以使用命令行（去充当这个客户端）</p>
<h3 id="Elasticsearch-面向文档"><a href="#Elasticsearch-面向文档" class="headerlink" title="Elasticsearch 面向文档"></a>Elasticsearch 面向文档</h3><p>Elasticsearch 是 面向文档 的，意味着它存储整个对象或 文档。Elasticsearch 不仅存储文档，而且 索引 每个文档的内容，使之可以被检索。在 Elasticsearch 中，我们对文档进行索引、检索、排序和过滤—​而不是对行列数据。这是一种完全不同的思考数据的方式，也是 Elasticsearch 能支持复杂全文检索的原因</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/26/db/esbase/" data-id="clpfb6uhe000stoqw6nie9cx3" data-title="ES基础" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ES/" rel="tag">ES</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-db/esapi" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/26/db/esapi/" class="article-date">
  <time class="dt-published" datetime="2022-07-26T05:54:57.000Z" itemprop="datePublished">2022-07-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DB/">DB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/26/db/esapi/">Es RESTful Api</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="查询所有索引信息"><a href="#查询所有索引信息" class="headerlink" title="查询所有索引信息"></a>查询所有索引信息</h3><ul>
<li>http:///_cat/indices</li>
</ul>
<h3 id="索引映射查看"><a href="#索引映射查看" class="headerlink" title="索引映射查看"></a>索引映射查看</h3><ul>
<li>get http:///agent-info</li>
</ul>
<h3 id="索引设置查看"><a href="#索引设置查看" class="headerlink" title="索引设置查看"></a>索引设置查看</h3><ul>
<li>get http:///agent-info/_settings</li>
</ul>
<h3 id="索引删除"><a href="#索引删除" class="headerlink" title="索引删除"></a>索引删除</h3><ul>
<li>delete  http:///agent-info</li>
</ul>
<h3 id="精确匹配"><a href="#精确匹配" class="headerlink" title="精确匹配"></a>精确匹配</h3><ul>
<li>get  http:///agent-info/_search</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;:&#123;</span><br><span class="line">        &quot;match&quot;:&#123;</span><br><span class="line">            &quot;ag_name&quot;: &quot;大石桥市旺达水果蔬菜便利店&quot;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="索引全文检索"><a href="#索引全文检索" class="headerlink" title="索引全文检索"></a>索引全文检索</h3><ul>
<li>get  http:///agent-info/_search</li>
</ul>
<h3 id="关键词分析"><a href="#关键词分析" class="headerlink" title="关键词分析"></a>关键词分析</h3><ul>
<li>get http:///_analyze<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot; : &quot;ik_max_word&quot;,</span><br><span class="line">  &quot;text&quot; : &quot;739183800@qq.com&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="cat操作类表"><a href="#cat操作类表" class="headerlink" title="_cat操作类表"></a>_cat操作类表</h3><ul>
<li>get http:///_cat</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">=^.^=</span><br><span class="line">/_cat/allocation</span><br><span class="line">/_cat/shards</span><br><span class="line">/_cat/shards/&#123;index&#125;</span><br><span class="line">/_cat/master</span><br><span class="line">/_cat/nodes</span><br><span class="line">/_cat/tasks</span><br><span class="line">/_cat/indices</span><br><span class="line">/_cat/indices/&#123;index&#125;</span><br><span class="line">/_cat/segments</span><br><span class="line">/_cat/segments/&#123;index&#125;</span><br><span class="line">/_cat/count</span><br><span class="line">/_cat/count/&#123;index&#125;</span><br><span class="line">/_cat/recovery</span><br><span class="line">/_cat/recovery/&#123;index&#125;</span><br><span class="line">/_cat/health</span><br><span class="line">/_cat/pending_tasks</span><br><span class="line">/_cat/aliases</span><br><span class="line">/_cat/aliases/&#123;alias&#125;</span><br><span class="line">/_cat/thread_pool</span><br><span class="line">/_cat/thread_pool/&#123;thread_pools&#125;</span><br><span class="line">/_cat/plugins</span><br><span class="line">/_cat/fielddata</span><br><span class="line">/_cat/fielddata/&#123;fields&#125;</span><br><span class="line">/_cat/nodeattrs</span><br><span class="line">/_cat/repositories</span><br><span class="line">/_cat/snapshots/&#123;repository&#125;</span><br><span class="line">/_cat/templates</span><br><span class="line">/_cat/ml/anomaly_detectors</span><br><span class="line">/_cat/ml/anomaly_detectors/&#123;job_id&#125;</span><br><span class="line">/_cat/ml/trained_models</span><br><span class="line">/_cat/ml/trained_models/&#123;model_id&#125;</span><br><span class="line">/_cat/ml/datafeeds</span><br><span class="line">/_cat/ml/datafeeds/&#123;datafeed_id&#125;</span><br><span class="line">/_cat/ml/data_frame/analytics</span><br><span class="line">/_cat/ml/data_frame/analytics/&#123;id&#125;</span><br><span class="line">/_cat/transforms</span><br><span class="line">/_cat/transforms/&#123;transform_id&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="健康检查"><a href="#健康检查" class="headerlink" title="健康检查"></a>健康检查</h3><ul>
<li><p>get http:///_cat/health</p>
<blockquote>
<p>1658815275 06:01:15 ryx green 3 3 10 8 0 0 0 0 - 100.0%</p>
</blockquote>
<h3 id="查看集群信息"><a href="#查看集群信息" class="headerlink" title="查看集群信息"></a>查看集群信息</h3></li>
<li><p>get http:///_cluster/health</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;cluster_name&quot;: &quot;ryx&quot;,</span><br><span class="line">    &quot;status&quot;: &quot;green&quot;,</span><br><span class="line">    &quot;timed_out&quot;: false,</span><br><span class="line">    &quot;number_of_nodes&quot;: 3,</span><br><span class="line">    &quot;number_of_data_nodes&quot;: 3,</span><br><span class="line">    &quot;active_primary_shards&quot;: 8,</span><br><span class="line">    &quot;active_shards&quot;: 10,</span><br><span class="line">    &quot;relocating_shards&quot;: 0,</span><br><span class="line">    &quot;initializing_shards&quot;: 0,</span><br><span class="line">    &quot;unassigned_shards&quot;: 0,</span><br><span class="line">    &quot;delayed_unassigned_shards&quot;: 0,</span><br><span class="line">    &quot;number_of_pending_tasks&quot;: 0,</span><br><span class="line">    &quot;number_of_in_flight_fetch&quot;: 0,</span><br><span class="line">    &quot;task_max_waiting_in_queue_millis&quot;: 0,</span><br><span class="line">    &quot;active_shards_percent_as_number&quot;: 100.0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="查看集群master"><a href="#查看集群master" class="headerlink" title="查看集群master"></a>查看集群master</h3></li>
<li><p>get http:///_cat/master</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TzHcEWPTRW-D8vFqj0lTUQ 12.3.10.105 12.3.10.105 node-105</span><br></pre></td></tr></table></figure>
<h3 id="查看集群节点信息"><a href="#查看集群节点信息" class="headerlink" title="查看集群节点信息"></a>查看集群节点信息</h3></li>
<li><p>get http:///_cat/nodes</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">12.3.10.205 65 97 3 0.02 0.11 0.17 cdfhilmrstw - node-205</span><br><span class="line">12.3.10.222 15 94 3 0.03 0.07 0.06 cdfhilmrstw - node-222</span><br><span class="line">12.3.10.105 51 98 2 0.06 0.08 0.02 cdfhilmrstw * node-105</span><br></pre></td></tr></table></figure>
<h3 id="查看集群分片信息"><a href="#查看集群分片信息" class="headerlink" title="查看集群分片信息"></a>查看集群分片信息</h3></li>
<li><p>get http:///_cat/shards</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">agent-info       2 p STARTED 13569   1.8mb 12.3.10.205 node-205</span><br><span class="line">agent-info       1 p STARTED 13104   1.8mb 12.3.10.205 node-205</span><br><span class="line">agent-info       0 p STARTED 13476   1.8mb 12.3.10.222 node-222</span><br><span class="line">.security-7      0 r STARTED     7  25.7kb 12.3.10.205 node-205</span><br><span class="line">.security-7      0 p STARTED     7  25.7kb 12.3.10.222 node-222</span><br><span class="line">.geoip_databases 0 r STARTED     4     4mb 12.3.10.205 node-205</span><br><span class="line">.geoip_databases 0 p STARTED     4     4mb 12.3.10.222 node-222</span><br><span class="line">order-info       2 p STARTED   570 266.7kb 12.3.10.222 node-222</span><br><span class="line">order-info       1 p STARTED   508 249.2kb 12.3.10.205 node-205</span><br><span class="line">order-info       0 p STARTED   521   259kb 12.3.10.222 node-222</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/26/db/esapi/" data-id="clpfb6uhc000ltoqw8jh32tf0" data-title="Es RESTful Api" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ES/" rel="tag">ES</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-db/redis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/26/db/redis/" class="article-date">
  <time class="dt-published" datetime="2022-07-26T05:34:35.000Z" itemprop="datePublished">2022-07-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DB/">DB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/26/db/redis/">Redis集群</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>cd redis/src<br>make MALLOC=libc</p>
<p>cd redis<br>make &amp;&amp; make install</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">port 7001 # 客户端连接端口</span><br><span class="line">bind 12.3.10.222 #实例绑定的IP地址</span><br><span class="line">logfile &quot;usr/local/src/redis-5.0.14/logs/6479.log&quot;</span><br><span class="line">dir /usr/local/src/redis-5.0.14/datas_6479 # redis实例数据配置存储位置</span><br><span class="line">daemonize yes # 是否以后台进程的方式启动redis实例</span><br><span class="line">pidfile /var/run/redis_7001.pid # 指定该进程pidfile</span><br><span class="line"></span><br><span class="line">cluster-enabled yes # 开启集群模式</span><br><span class="line">cluster-config-file # 集群中该实例的配置文件，该文件会在data目录下生成</span><br><span class="line">appendonly yes # 开启aop日志</span><br><span class="line">protected-mode no # 关闭保护模式</span><br><span class="line">requirepass cx # master开启密码保护</span><br><span class="line">masterauth cx # replica同master交互密码</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> src/redis-server cluster/redis-6474.config  </span><br><span class="line"> src/redis-server cluster/redis-6475.config </span><br><span class="line"> src/redis-server cluster/redis-6476.config </span><br><span class="line"> src/redis-server cluster/redis-6477.config </span><br><span class="line"> src/redis-server cluster/redis-6478.config </span><br><span class="line"> src/redis-server cluster/redis-6479.config </span><br><span class="line"></span><br><span class="line">#文本替换</span><br><span class="line">:1,$s/6479/6474/gc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">src/redis-cli -p cx --cluster create 12.3.10.222:6479 12.3.10.222:6478 12.3.10.222:6477 12.3.10.222:6476 12.3.10.222:6475 12.3.10.222:6474 --cluster-replicas 1 -a cx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ps aux|grep redis|grep -v &#x27;grep&#x27;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -15</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/26/db/redis/" data-id="clpfb6uhf000ztoqwfz799hse" data-title="Redis集群" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-java/jvm/parallel" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/25/java/jvm/parallel/" class="article-date">
  <time class="dt-published" datetime="2022-07-25T02:42:36.000Z" itemprop="datePublished">2022-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tc/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/25/java/jvm/parallel/">jvm参数配置</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <img src="/2022/07/25/java/jvm/parallel/jvmmap.png" class="" title="jvmmap">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line">-Xms1g</span><br><span class="line">-Xmx2g</span><br><span class="line">-XX:+UseCMSInitiatingOccupancyOnly</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=70</span><br><span class="line">-XX:CMSFullGCsBeforeCompaction=0</span><br><span class="line">-XX:+UseCMSCompactAtFullCollection</span><br><span class="line">-XX:ParallelGCThreads=4</span><br></pre></td></tr></table></figure>

<hr>
<p>Serial垃圾收集器（新生代） 新生代使用Serial  老年代则使用SerialOld     </p>
<blockquote>
<p>开启：-XX:+UseSerialGC 关闭：-XX:-UseSerialGC</p>
</blockquote>
<blockquote>
<blockquote>
<p>SerialOld收集器(串行老年代) 搭配Parallel Scavenge使用  及  CMS发生Concurrent Mode Failure之后的预案</p>
</blockquote>
</blockquote>
<p>ParNew垃圾收集器（新生代） 新生代使用功能ParNew 老年代则使用功能CMS</p>
<blockquote>
<p>开启 -XX:+UseParNewGC 关闭 -XX:-UseParNewGC</p>
</blockquote>
<p>Parallel Scavenge收集器（新生代） 新生代使用功能Parallel Scavenge 老年代将会使用Parallel Old收集器</p>
<blockquote>
<p>开启 -XX:+UseParallelGC 关闭 -XX:-UseParallelGC </p>
</blockquote>
<hr>
<p>ParallelOld垃圾收集器（老年代） 新生代使用功能Parallel Scavenge 老年代将会使用Parallel Old收集器</p>
<blockquote>
<p>开启 -XX:+UseParallelOldGC 关闭 -XX:-UseParallelOldGC</p>
</blockquote>
<p>CMS垃圾收集器（老年代）  新生代使用功能ParNew 老年代则使用功能CMS 老年代担保失败 则采用SerialOld收集器串行收集</p>
<blockquote>
<p>开启 -XX:+UseConcMarkSweepGC 关闭 -XX:-UseConcMarkSweepGC</p>
</blockquote>
<p> G1垃圾收集器</p>
<blockquote>
<p>开启 -XX:+UseG1GC 关闭 -XX:-UseG1GC</p>
</blockquote>
<hr>
<h3 id="对象的一些配置"><a href="#对象的一些配置" class="headerlink" title="对象的一些配置"></a>对象的一些配置</h3><ul>
<li>-XX:+UseTLAB  开启本地线程预分配</li>
<li>-XX:InitialTenuringThreshol=7  年轻代对象转换为老年代对象最小年龄值，默认值7</li>
<li>-XX:MaxTenuringThreshold=15 进入老年代最大的GC年龄 年轻代对象转换为老年代对象最大年龄值，默认值15</li>
</ul>
<blockquote>
<p>动态年龄判断：</p>
<blockquote>
<p>虚拟机不是永远要去对象的年龄必须达到MaxTenuringThreshold才能晋升老年代，如果在Survivor空间中相同年龄所有对象大小的总和大于Survivor空间的一半，年龄大于或等于该年龄的对象就可以直接进入老年代，无需等到MaxTenuringThreshold中要求的年龄</p>
</blockquote>
</blockquote>
<ul>
<li>-XX:PretenureSizeThreshold=1000000 新生代可容纳的最大对象，超过此值直接进入老年代</li>
</ul>
<h3 id="内存空间的配置"><a href="#内存空间的配置" class="headerlink" title="内存空间的配置"></a>内存空间的配置</h3><ul>
<li>-Xms2g：初始堆空间内存 （默认为物理内存的1/64）</li>
<li>-Xmx2g：最大堆空间内存（默认为物理内存的1/4）</li>
<li>-Xmn512m：设置新生代的大小。(初始值及最大值)</li>
<li>-Xss512k：线程堆栈大小</li>
<li>-XX:MetaspaceSize ：初始化的Metaspace大小</li>
<li>-XX:MaxMetaspaceSize：Metaspace最大值</li>
<li>-XX:NewRatio=2：配置新生代与老年代在堆结构的占比 老年代:新生代 = 2:1 ，新生代占整个堆的1/3</li>
<li>-XX:SurvivorRatio=8：设置新生代中Eden和S0/S1空间的比例 eden:S = 8:1</li>
<li>-XX:MaxTenuringThreshold=15：设置新生代垃圾的最大年龄</li>
<li>-XX:+PrintGCDetails：输出详细的GC处理日志</li>
<li>打印gc简要信息：① -XX:+PrintGC   ② -verbose:gc</li>
<li>-XX:HandlePromotionFailure=true：是否设置空间分配担保</li>
<li>-XX:MaxDirectMemorySize=2g：堆外直内存配置</li>
</ul>
<blockquote>
<p>空间分配担保：</p>
<blockquote>
<p>jdk6之前在发生minorGc之前，虚拟机会先检查老年代最大可用连续空间是否大于新生代所有对象总空间，如果这个条件成立，那么MinorGc可以确保安全，如果不成立，虚拟机会查看-XX:HandlePromotionFailure<br>jdk7及以后只要老年代的连续空间大于新生代对象的总大小或者历次晋升到老年代的对象的平均大小就进行MinorGC，否则FullGC，HandlePromotionFailure 不再使用</p>
</blockquote>
</blockquote>
<h3 id="并发标记清除收集器相关配置"><a href="#并发标记清除收集器相关配置" class="headerlink" title="并发标记清除收集器相关配置"></a>并发标记清除收集器相关配置</h3><ul>
<li>-XX:+UseConcMarkSweepGC ：打开CMS收集器 新生代默认使用ParNewGc, 担保失败使用SerialOld</li>
<li>-XX:+UseCMSInitiatingOccupancyOnly ： 指定用设定的回收阈值(-XX:CMSInitiatingOccupancyFraction参数的值),如果不指定,JVM仅在第一次使用设定值,后续则会根据运行时采集的数据做自动调整，如果指定了该参数，那么每次JVM都会在到达规定设定值时才进行GC</li>
<li>-XX:CMSInitiatingOccupancyFraction=75 ：老年代被使用的内存空间的阈值，达到该阈值则触发Full GC 75%</li>
<li>-XX:CMSFullGCsBeforeCompaction=0 ：由于并发收集器不对内存空间进行压缩、整理，所以运行一段时间以后会产生“碎片”，使得运行效率降低。此值设置运行多少次GC以后对内存空间进行压缩、整理。</li>
<li>-XX:+UseCMSCompactAtFullCollection ：在FullGc后进行整理压缩操作 打开压缩功能</li>
</ul>
<h3 id="垃圾收集线程"><a href="#垃圾收集线程" class="headerlink" title="垃圾收集线程"></a>垃圾收集线程</h3><ul>
<li>-XX:ParallelGCThreads=20 ：并发收集线程数</li>
</ul>
<h3 id="Parallel-收集器-关注吞吐量"><a href="#Parallel-收集器-关注吞吐量" class="headerlink" title="Parallel 收集器 关注吞吐量"></a>Parallel 收集器 关注吞吐量</h3><p>-XX:+UseParallelGC 使用Parallel Scavenge + Serial Old组合收集器  新生代</p>
<p>-XX:+UseParallelOldGC 使用Parallel Scavenge +Parallel Old组合收集器 老年代</p>
<p>-XX:+UseAdaptiveSizePolicy  自适应调节策略 配合 -XX:MaxGCPauseMillis -XX:GCTimeRatio 使用,主要控制新生代收集</p>
<p>-XX:MaxGCPauseMillis=100  控制最大垃圾收集停顿时间 值是一个大于0的毫秒数</p>
<p>-XX:GCTimeRatio=99 直接设置吞吐量大小 大于0且小于100的整数 如果把此参数设置为19，那允许的最大GC时间就占总时间的5%（既1 /（1 + 19）），默认值为99，就是允许最大1%（既 1 /（1 + 99））的垃圾收集时间</p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/25/java/jvm/parallel/" data-id="clpfb6uhz0040toqwdl8d5lq5" data-title="jvm参数配置" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jvm/" rel="tag">jvm</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-java/jvm/gc" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/21/java/jvm/gc/" class="article-date">
  <time class="dt-published" datetime="2022-07-21T08:25:53.000Z" itemprop="datePublished">2022-07-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tc/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/21/java/jvm/gc/">JVM G1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#堆</span><br><span class="line">-Xms/-Xmx</span><br><span class="line"></span><br><span class="line">#分区 Region</span><br><span class="line">-XX:G1HeapRegionSize=1048576(1m) #可指定分区大小(1MB~32MB，且必须是2的幂)，默认将整堆划分为2048个分区</span><br><span class="line"></span><br><span class="line">#卡片(Card) 和全局卡片 (Global Card Table) 和 记录卡片(Rset)</span><br><span class="line"></span><br><span class="line">-XX:+UseG1GC </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-XX:InitialHeapSize=1073741824 </span><br><span class="line">-XX:InitiatingHeapOccupancyPercent=35 </span><br><span class="line">-XX:+ManagementServer </span><br><span class="line">-XX:MarkStackSize=4194304 </span><br><span class="line">#GC与应用的耗费时间比 G1默认为9(10)，而CMS默认为99(100) CMS的设计原则是耗费在GC上的时间尽可能的少</span><br><span class="line">-XX:GCTimeRatio </span><br><span class="line">#目标暂停时间 默认200ms</span><br><span class="line">-XX:MaxGCPauseMillis=20 </span><br><span class="line">#最大的堆内存容量</span><br><span class="line">-XX:MaxHeapSize=1073741824</span><br><span class="line"></span><br><span class="line">####################################年轻代</span><br><span class="line">#年轻代配置固定大小 (固定值)</span><br><span class="line">-Xmn100m</span><br><span class="line">#年轻代比例 (固定值比例)</span><br><span class="line">-XX:NewRatio=1   </span><br><span class="line">#最大的年轻代容量 (固定值大小 可伸缩)</span><br><span class="line">-XX:NewSize=2m </span><br><span class="line">#最大的年轻代容量 (固定值大小 可伸缩)</span><br><span class="line">-XX:MaxNewSize=2m  </span><br><span class="line">#整个年轻代内存初始空间 (按比例配置 可伸缩)</span><br><span class="line">-XX:G1NewSizePercent=5</span><br><span class="line">#整个年轻代内存最大空间 (按比例配置 可伸缩)</span><br><span class="line">-XX:G1MaxNewSizePercent=60</span><br><span class="line"></span><br><span class="line">#####################垃圾回收</span><br><span class="line">#晋升到老年代的对象任期阈值 </span><br><span class="line">-XX:MaxTenuringThreshold=15 </span><br><span class="line"></span><br><span class="line">#老年代</span><br><span class="line">#每轮MixedGC回收的Region的最大比例 CSet对堆的总大小占比 10%</span><br><span class="line">-XX:G1OldCSetRegionThresholdPercent=10</span><br><span class="line"></span><br><span class="line">#候选老年代分区的CSet准入条件，活跃度阈值 85% 区域内存活的对象低于此值，那么该区将被纳入Cset,当GC时间过长时候，可适当调整低此值，过了此值就会被GC带走</span><br><span class="line">-XX:G1MixedGCLiveThresholdPercent=85</span><br><span class="line"></span><br><span class="line">#混合垃圾收集阈值   当老年代占用空间超过整堆比IHOP阈值(默认45%)时，Occupancy(占用) G1就会启动一次混合垃圾收集周期。</span><br><span class="line">#为了满足暂停目标，G1可能不能一口气将所有的候选分区收集掉，</span><br><span class="line">#因此G1可能会产生连续多次的混合收集与应用线程交替执行，每次STW的混合收集与年轻代收集过程相类似</span><br><span class="line">-XX:InitiatingHeapOccupancyPercent=45</span><br><span class="line"></span><br><span class="line">#通过候选老年代分区总数与混合周期最大总次数，确定每次包含到CSet的最小分区数量(确定加入混合Cset的分区数量)；根据堆废物百分比，当收集达到参数低于时5%，不再启动新的混合收集（确定是否MixGc）</span><br><span class="line">#混合周期的最大总次数(默认8)</span><br><span class="line">-XX:G1MixedGCCountTarget=8</span><br><span class="line">#堆废物百分比(默认5%)  垃圾占整个堆的百分比，如果超过5%，将触发多轮的MIXgc</span><br><span class="line">-XX:G1HeapWastePercent=5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-XX:GCLogFileSize=104857600 </span><br><span class="line">-XX:MinHeapDeltaBytes=1048576 </span><br><span class="line">-XX:NumberOfGCLogFiles=10 </span><br><span class="line">-XX:+PrintGC </span><br><span class="line">-XX:+PrintGCDateStamps </span><br><span class="line">-XX:+PrintGCDetails </span><br><span class="line">-XX:+PrintGCTimeStamps </span><br><span class="line">-XX:+UnlockCommercialFeatures </span><br><span class="line">-XX:+UseCompressedClassPointers </span><br><span class="line">-XX:+UseCompressedOops </span><br><span class="line"></span><br><span class="line">-XX:+UseGCLogFileRotation </span><br></pre></td></tr></table></figure>

<h1 id="分代模型"><a href="#分代模型" class="headerlink" title="分代模型"></a>分代模型</h1><p>分代模型的是将关注点放在最近被分配的对像上，因为大部分的对象是可以很快被回收的，只有少量的对象的生命周期是长的。分代可可以避免整堆扫描，避免长生命周期的对象的拷贝，同事独立收集可以降低响应时间。</p>
<h2 id="分代-Generation"><a href="#分代-Generation" class="headerlink" title="分代 Generation"></a>分代 Generation</h2><p>G1将内存在逻辑上划分为年轻代和老年代Old，其中年轻代又划分为Eden空间和Survivor空间。但年轻代空间并不是固定不变的，当现有年轻代分区占满时，JVM会分配新的空闲分区加入到年轻代空间</p>
<h2 id="本地分配缓冲-Local-allocation-buffer-TLAB"><a href="#本地分配缓冲-Local-allocation-buffer-TLAB" class="headerlink" title="本地分配缓冲 Local allocation buffer (TLAB)"></a>本地分配缓冲 Local allocation buffer (TLAB)</h2><p>解决对象在堆内存分配操作时候的并发情况。</p>
<p>由于分区的思想，每个线程均可以”认领”某个分区用于线程本地的内存分配，而不需要顾及分区是否连续。因此，每个应用线程和GC线程都会独立的使用分区，进而减少同步时间，提升GC效率，这个分区称为本地分配缓冲区(Lab)。</p>
<p>TLAB 应用线程本地缓冲区 应用线程可以独占一个本地缓冲区(TLAB)来创建的对象，而大部分都会落入Eden区域(巨型对象或分配失败除外)，因此TLAB的分区属于Eden空间</p>
<p>GCLAB 每个GC线程同样可以独占一个本地缓冲区(GCLAB)用来转移对象，每次回收会将对象复制到Suvivor空间或老年代空间；对于从Eden/Survivor空间晋升(Promotion)到Survivor/老年代空间的对象，同样有GC独占的本地缓冲区进行操作，该部分称为晋升本地缓冲区(PLAB)。</p>
<h2 id="分区模型"><a href="#分区模型" class="headerlink" title="分区模型"></a>分区模型</h2><ul>
<li><h3 id="Region"><a href="#Region" class="headerlink" title="Region"></a>Region</h3><p>G1对内存的使用以分区(Region)为单位，而对对象的分配则以卡片(Card)为单位。</p>
</li>
<li><h3 id="Card-全局卡片Global-Card-Table"><a href="#Card-全局卡片Global-Card-Table" class="headerlink" title="Card/全局卡片Global Card Table"></a>Card/全局卡片Global Card Table</h3><p>每个分区内部又被分成了若干个大小为512 Byte卡片(Card)，标识堆内存最小可用粒度所有分区的卡片将会记录在全局卡片表(Global Card Table)中，分配的对象会占用物理上连续的若干个卡片，当查找对分区内对象的引用时便可通过记录卡片来查找该引用对象(见RSet)。每次对内存的回收，都是对指定分区的卡片进行处理</p>
</li>
<li><h3 id="记录卡片Rset"><a href="#记录卡片Rset" class="headerlink" title="记录卡片Rset"></a>记录卡片Rset</h3><blockquote>
<p>Rset 记录了引用当前分区内对象的引用所在的卡片的索引，帮助确定分区内对象是否存活。</p>
</blockquote>
</li>
</ul>
<p>在串行和并行收集器中，GC通过整堆扫描，来确定对象是否处于可达路径中。然而G1为了避免STW式的整堆扫描，在每个分区记录了一个已记忆集合(RSet)，内部类似一个反向指针，记录引用分区内对象的卡片索引。当要回收该分区时，通过扫描分区的RSet，来确定引用本分区内的对象是否存活，进而确定本分区内的对象存活情况。</p>
<p>事实上，并非所有的引用都需要记录在RSet中，如果一个分区确定需要扫描，那么无需RSet也可以无遗漏的得到引用关系。那么引用源自本分区的对象，当然不用落入RSet中；同时，G1 GC每次都会对年轻代进行整体收集，因此引用源自年轻代的对象，也不需要在RSet中记录。最后只有老年代的分区可能会有RSet记录，这些分区称为拥有RSet分区(an RSet’s owning region)</p>
<ul>
<li><h3 id="Per-Region-Table-PRT"><a href="#Per-Region-Table-PRT" class="headerlink" title="Per Region Table(PRT)"></a>Per Region Table(PRT)</h3>RSet在内部使用Per Region Table(PRT)记录分区的引用情况。由于RSet的记录要占用分区的空间，如果一个分区非常”受欢迎”(该分区内的对象很多都被别的对象引用)，那么RSet占用的空间会上升，从而降低分区的可用空间。G1应对这个问题采用了改变RSet的密度的方式，在PRT中将会以三种模式记录引用：</li>
</ul>
<ol>
<li>稀少：直接记录引用对象的卡片索引</li>
<li>细粒度：记录引用对象的分区索引</li>
<li>粗粒度：只记录引用情况，每个分区对应一个比特位<br>由上可知，粗粒度的PRT只是记录了引用数量，需要通过整堆扫描才能找出所有引用，因此扫描速度也是最慢的</li>
</ol>
<ul>
<li><h3 id="收集集合-CSet"><a href="#收集集合-CSet" class="headerlink" title="收集集合 CSet"></a>收集集合 CSet</h3></li>
</ul>
<p>收集集合(CSet)代表每次GC暂停时回收的一系列目标分区（待垃圾回收的分区记录集合表），任意一次收集暂停中，CSet所有分区都会被释放，内部存活的对象都会被转移到分配的空闲分区中。因此无论是年轻代收集，还是混合收集，工作的机制都是一致的。</p>
<p>年轻代收集CSet只容纳年轻代分区，而混合收集会通过启发式算法，在老年代候选回收分区中，筛选出回收收益最高的分区添加到CSet中。候选老年代分区的CSet准入条件，可以通过活跃度阈值-XX:G1MixedGCLiveThresholdPercent(默认85%)进行设置（活跃度在85的分区不进入Cset），从而拦截那些回收开销巨大的对象；</p>
<p>同时，每次混合收集时候可以包含候选老年代分区一同收集，可根据CSet对堆的总大小占比-XX:G1OldCSetRegionThresholdPercent(默认10%)设置数量上限,每轮MixedGC回收的Region的最大比例，最多10% ，控制回收时间，可限制候选区一同收集。</p>
<p>由上述可知，G1的收集都是根据CSet进行操作的，年轻代收集与混合收集没有明显的不同，最大的区别在于两种收集的触发条件。</p>
<h2 id="巨型对象-Humongous-Region"><a href="#巨型对象-Humongous-Region" class="headerlink" title="巨型对象 Humongous Region"></a>巨型对象 Humongous Region</h2><p>一个大小达到甚至超过分区大小一半的对象称为巨型对象(Humongous Object)。当线程为巨型分配空间时，不能简单在TLAB进行分配，因为巨型对象的移动成本很高，而且有可能一个分区不能容纳巨型对象。因此，巨型对象会直接在老年代分配，所占用的连续空间称为巨型分区(Humongous Region)。G1内部做了一个优化，一旦发现没有引用指向巨型对象，则可直接在年轻代收集周期中被回收。</p>
<p>巨型对象会独占一个、或多个连续分区，其中第一个分区被标记为开始巨型(StartsHumongous)，相邻连续分区被标记为连续巨型(ContinuesHumongous)。由于无法享受Lab带来的优化，并且确定一片连续的内存空间需要扫描整堆，因此确定巨型对象开始位置的成本非常高，如果可以，应用程序应避免生成巨型对象</p>
<h2 id="收集"><a href="#收集" class="headerlink" title="收集"></a>收集</h2><h3 id="年轻代收集-CSet-of-Young-Collection"><a href="#年轻代收集-CSet-of-Young-Collection" class="headerlink" title="年轻代收集  CSet of Young Collection"></a>年轻代收集  CSet of Young Collection</h3><p>应用线程不断活动后，年轻代空间会被逐渐填满。当JVM分配对象到Eden区域失败(Eden区已满)时，便会触发一次STW式的年轻代收集。在年轻代收集中，Eden分区存活的对象将被拷贝到Survivor分区；原有Survivor分区存活的对象，将根据任期阈值(tenuring threshold)分别晋升到PLAB中，新的survivor分区和老年代分区。而原有的年轻代分区将被整体回收掉。</p>
<p>同时，年轻代收集还负责维护对象的年龄(存活次数)，辅助判断老化(tenuring)对象晋升的时候是到Survivor分区还是到老年代分区。年轻代收集首先先将晋升对象尺寸总和、对象年龄信息维护到年龄表中，再根据年龄表、Survivor尺寸、Survivor填充容量-XX:TargetSurvivorRatio(默认50%)、最大任期阈值-XX:MaxTenuringThreshold(默认15)，计算出一个恰当的任期阈值，凡是超过任期阈值的对象都会被晋升到老年代。</p>
<h3 id="混合收集集合-CSet-of-Mixed-Collection"><a href="#混合收集集合-CSet-of-Mixed-Collection" class="headerlink" title="混合收集集合  CSet of Mixed Collection"></a>混合收集集合  CSet of Mixed Collection</h3><p>年轻代收集不断活动后，老年代的空间也会被逐渐填充。当老年代占用空间超过整堆比IHOP阈值-XX:InitiatingHeapOccupancyPercent(默认45%)时，G1就会启动一次混合垃圾收集周期。为了满足暂停目标，G1可能不能一口气将所有的候选分区收集掉，因此G1可能会产生连续多次的混合收集与应用线程交替执行，每次STW的混合收集与年轻代收集过程相类似。</p>
<p>为了确定包含到年轻代收集集合CSet的老年代分区，JVM通过参数混合周期的最大总次数-XX:G1MixedGCCountTarget(默认8)、堆废物百分比-XX:G1HeapWastePercent(默认5%)。通过候选老年代分区总数与混合周期最大总次数，确定每次包含到CSet的最小分区数量；根据堆废物百分比，当收集达到参数时，不再启动新的混合收集。而每次添加到CSet的分区，则通过计算得到的GC效率进行安排</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/21/java/jvm/gc/" data-id="clpfb6uhw003ltoqw5m201yop" data-title="JVM G1" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jvm/" rel="tag">jvm</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DB/">DB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tc/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%9F%A5%E8%AF%86/">知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD/">系统性能</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">软件工程</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDD/" rel="tag">DDD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design/" rel="tag">Design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES/" rel="tag">ES</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Seata/" rel="tag">Seata</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" rel="tag">SpringCloud负载均衡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/activity/" rel="tag">activity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arthas/" rel="tag">arthas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/" rel="tag">jvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openssl/" rel="tag">openssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/questions/" rel="tag">questions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springmvc/" rel="tag">springmvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/" rel="tag">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uml/" rel="tag">uml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/" rel="tag">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95/" rel="tag">开发方法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%87%E5%87%86/" rel="tag">标准</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%96%AF%E4%BC%A0/" rel="tag">疯传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" rel="tag">负载均衡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%87%E7%A8%8B%E6%A8%A1%E5%9E%8B/" rel="tag">过程模型</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" rel="tag">项目管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6/" rel="tag">项目管理相关文件</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/DDD/" style="font-size: 10px;">DDD</a> <a href="/tags/Design/" style="font-size: 12.5px;">Design</a> <a href="/tags/Docker/" style="font-size: 12.5px;">Docker</a> <a href="/tags/ES/" style="font-size: 15px;">ES</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Seata/" style="font-size: 12.5px;">Seata</a> <a href="/tags/SpringCloud/" style="font-size: 10px;">SpringCloud</a> <a href="/tags/SpringCloud%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" style="font-size: 10px;">SpringCloud负载均衡</a> <a href="/tags/activity/" style="font-size: 12.5px;">activity</a> <a href="/tags/arthas/" style="font-size: 10px;">arthas</a> <a href="/tags/java/" style="font-size: 12.5px;">java</a> <a href="/tags/jvm/" style="font-size: 20px;">jvm</a> <a href="/tags/linux/" style="font-size: 12.5px;">linux</a> <a href="/tags/openssl/" style="font-size: 12.5px;">openssl</a> <a href="/tags/oracle/" style="font-size: 10px;">oracle</a> <a href="/tags/questions/" style="font-size: 10px;">questions</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/spring/" style="font-size: 17.5px;">spring</a> <a href="/tags/springmvc/" style="font-size: 17.5px;">springmvc</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/uml/" style="font-size: 10px;">uml</a> <a href="/tags/zookeeper/" style="font-size: 10px;">zookeeper</a> <a href="/tags/%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95/" style="font-size: 10px;">开发方法</a> <a href="/tags/%E6%A0%87%E5%87%86/" style="font-size: 10px;">标准</a> <a href="/tags/%E7%96%AF%E4%BC%A0/" style="font-size: 10px;">疯传</a> <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" style="font-size: 10px;">负载均衡</a> <a href="/tags/%E8%BF%87%E7%A8%8B%E6%A8%A1%E5%9E%8B/" style="font-size: 10px;">过程模型</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" style="font-size: 12.5px;">项目管理</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6/" style="font-size: 10px;">项目管理相关文件</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/26/softwareeng/DDD/">保持模型的完整性</a>
          </li>
        
          <li>
            <a href="/2023/11/25/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95%E4%B9%8BRUP/">软件过程模型之RUP</a>
          </li>
        
          <li>
            <a href="/2022/08/31/db/oracl/sqlanalysi/">ORACLE sql 分析</a>
          </li>
        
          <li>
            <a href="/2022/08/26/java/arthas/">vmtoll</a>
          </li>
        
          <li>
            <a href="/2022/07/26/db/mysql/">Mysql数据类型</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 晓<br>
      Powered by <a href="https://hexo.io/" target="_blank">晓</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about/me" class="mobile-nav-link">关于</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>