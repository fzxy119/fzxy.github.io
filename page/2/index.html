<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="别来无恙">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="别来无恙">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="二哥关羽">
<meta property="article:tag" content="技术 生活 hexo 笔记 晓">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>别来无恙</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">别来无恙</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">半心人</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/me" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="二哥关羽"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">二哥关羽</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:fzxy_119@sina.com" title="E-Mail → mailto:fzxy_119@sina.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/19/java/jvm/javamissioncontol/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/19/java/jvm/javamissioncontol/" class="post-title-link" itemprop="url">JMC(Java Mission Control)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-19 13:55:31" itemprop="dateCreated datePublished" datetime="2022-07-19T13:55:31+08:00">2022-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tc/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JMC-客户端使用JMX-链接到JVM"><a href="#JMC-客户端使用JMX-链接到JVM" class="headerlink" title="JMC 客户端使用JMX 链接到JVM"></a>JMC 客户端使用JMX 链接到JVM</h1><p>一个是JMX端口（需要指定），JMX远程连接端口。<br>一个是RMI端口（默认随机），实际通信用的端口。<br>一个是本地服务端口（随机），用于本地jstat、jconsole连接用，本地使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=&quot;-Dcom.sun.management.jmxremote=true</span><br><span class="line">-Djava.rmi.server.hostname=10.3.60.150</span><br><span class="line">-Dcom.sun.management.jmxremote.port=10000  </span><br><span class="line">-Dcom.sun.management.jmxremote.rmi.port=10001</span><br><span class="line">-Dcom.sun.management.jmxremote.ssl=false    </span><br><span class="line">-Dcom.sun.management.jmxremote.authenticate=true </span><br><span class="line">-Dcom.sun.management.jmxremote.password.file=/root/jmx/jmxremote.password</span><br><span class="line">-Dcom.sun.management.jmxremote.access.file=/root/jmx/jmxremote.access</span><br><span class="line">-XX:+UnlockCommercialFeatures</span><br><span class="line">-XX:+FlightRecorder</span><br><span class="line">-XX:StartFlightRecording=duration=60s,filename=150-cms-startFlight.jfr</span><br><span class="line">-XX:FlightRecorderOptions=defaultrecording=true,dumponexit=true,dumponexitpath=150-cms-onexit.jfr&quot;</span><br></pre></td></tr></table></figure>


<ul>
<li>控制密码文件有限传阅<br>chmode 600 password.file<br>chmode 600 access.file</li>
</ul>
<h1 id="JVM-使用命令行启动飞行器"><a href="#JVM-使用命令行启动飞行器" class="headerlink" title="JVM 使用命令行启动飞行器"></a>JVM 使用命令行启动飞行器</h1><p>解锁商业功能:UnlockCommercialFeatures  使JFR可用:FlightRecorder  短暂监控 StartFlightRecording 启动飞行器，持续时间60s 并保持到文件myrecording.jfr</p>
<p>-XX:+|-UnlockCommercialFeatures</p>
<p>-XX:+|-FlightRecorder</p>
<p>-XX:FlightRecorderOptions=defaultrecording=true,dumponexit=true,dumponexitpath=onexit.jfr,loglevel=trace</p>
<p>-XX:StartFlightRecording=duration=60s</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UnlockCommercialFeatures -XX:+FlightRecorder -XX:StartFlightRecording=duration=60s,filename=startFlight.jfr  -XX:FlightRecorderOptions=defaultrecording=true,dumponexit=true,dumponexitpath=onexit.jfr,loglevel=trace MyApp</span><br></pre></td></tr></table></figure>

<p>在 JVM 启动参数中加入-XX:+StartFlightRecording=参数启动记录事件。参数为一个以逗号间隔的键值对数据。下面将介绍这些选项：</p>
<p>name=name<br>指定记录的名称</p>
<p>defaultrecording=true/false<br>是否在初始化时启动记录事件，默认为 false，对于反应分析，应设置为 true</p>
<p>settings=path<br>JFR 配置文件的路径</p>
<p>delay=time<br>开始记录前的延时</p>
<p>duration=time<br>记录持续时间</p>
<p>filename=path<br>保存记录事件的文件路径</p>
<p>compress=true/false<br>是否使用 gzip 压缩记录数据，默认为 false</p>
<p>maxage=time<br>环形缓存中保存记录的数据的最长时间</p>
<p>maxsize=size<br>环形缓存占用的最大空间</p>
<h1 id="使用动态命令"><a href="#使用动态命令" class="headerlink" title="使用动态命令"></a>使用动态命令</h1><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/run.htm#JFRUH164">官方参考文档</a></p>
<h3 id="启动飞行器"><a href="#启动飞行器" class="headerlink" title="启动飞行器"></a>启动飞行器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">jcmd process_id JFR.start [option_list]</span><br><span class="line"></span><br><span class="line">jcmd pid JFR.start duration=60s filename=myrecording.jfr</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看pid jvm 可执行的命令</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jcmd  pid  help</span><br></pre></td></tr></table></figure>

<ol>
<li>JFR.start</li>
</ol>
<p>启动飞行器</p>
<ol start="2">
<li>JFR.check</li>
</ol>
<p>检查为指定进程运行的所有录制的状态，包括录制标识号、文件名、持续时间等</p>
<ol start="3">
<li>JFR.stop</li>
</ol>
<p>停止带有特定标识号的飞行器(默认情况下，停止飞行器1)。</p>
<ol start="4">
<li>JFR.dump</li>
</ol>
<p>转储到目前为止由具有特定标识号的记录收集的数据(默认情况下，转储来自记录1的数据)。</p>
<h2 id="Access-denied-Invalid-access-level-for-requested-MBeanServer-operation"><a href="#Access-denied-Invalid-access-level-for-requested-MBeanServer-operation" class="headerlink" title="Access denied! Invalid access level for requested MBeanServer operation."></a>Access denied! Invalid access level for requested MBeanServer operation.</h2><p>配置 JRE_HOME/lib/management/jmxremote.access  <em><strong>com.sun.management.</strong></em>*</p>
<p>monitorRole   readonly<br>controlRole   readwrite <br>              create javax.management.monitor.<em>,javax.management.timer.</em>,com.oracle.jrockit.<em>,com.sun.management.</em> <br>              unregister</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/18/java/jvm/jprofiler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/18/java/jvm/jprofiler/" class="post-title-link" itemprop="url">Jprofiler</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-18 16:56:20" itemprop="dateCreated datePublished" datetime="2022-07-18T16:56:20+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tc/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-核心组件"><a href="#1-核心组件" class="headerlink" title="1. 核心组件"></a>1. 核心组件</h1><p>JProfiler 包含用于采集目标 JVM 分析数据的 JProfiler agent、用于可视化分析数据的 JProfiler UI、提供各种功能的命令行工具.</p>
<p>它们之间的关系如下图所示:</p>
<img src="/2022/07/18/java/jvm/jprofiler/JPROFILER.png" class="" title="JPROFILER架构图">

<h3 id="JProfiler-agent"><a href="#JProfiler-agent" class="headerlink" title="JProfiler agent"></a>JProfiler agent</h3><p>JProfiler agent 是一个本地库，它可以在 JVM 启动时通过参数-agentpath:<path to native library>进行加载或者在程序运行时通过 JVM Attach 机制进行加载。Agent 被成功加载后，会设置 JVMTI 环境，监听虚拟机产生的事件，如类加载、线程创建等。例如，当它监听到类加载事件后，会给这些类注入用于执行度量操作的字节码。</p>
<h3 id="JProfiler-UI"><a href="#JProfiler-UI" class="headerlink" title="JProfiler UI"></a>JProfiler UI</h3><p>JProfiler UI 是一个可独立部署的组件，它通过 socket 和 agent 建立连接。这意味着不论目标 JVM 运行在本地还是远端，JProfiler UI 和 agent 间的通信机制都是一样的。</p>
<p>JProfiler UI 的主要功能是展示通过 agent 采集上来的分析数据，此外还可以通过它控制 agent 的采集行为，将快照保存至磁盘，展示保存的快照。</p>
<h3 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h3><p>JProfiler 提供了一系列命令行工具以实现不同的功能。</p>
<p>jpcontroller - 用于控制 agent 的采集行为。它通过 agent 注册的 JProfiler MBean 向 agent 传递命令。</p>
<p>jpenable - 用于将 agent 加载到一个正在运行的 JVM 上。</p>
<p>jpdump - 用于获取正在运行的 JVM 的堆快照。</p>
<p>jpexport &amp; jpcompare - 用于从保存的快照中提取数据并创建 HTML 报告。</p>
<p>要想对一个JVM进行分析，JProfiler的分析代理必须被加载到该JVM中。这可以通过两种不同的方式实现： 通过在启动脚本中指定一个-agentpath VM参数，或者通过Attach API将代理加载到已经运行的JVM中</p>
<p>两种模式JProfiler都支持。添加VM参数是分析的首选方式，集成向导、IDE插件和从JProfiler内启动JVM的会话配置都使用这种方式。 Attach既可在本地使用，也可通过SSH远程使用。</p>
<h1 id="2-JProfiler-设置"><a href="#2-JProfiler-设置" class="headerlink" title="2. JProfiler 设置"></a>2. JProfiler 设置</h1><h2 id="数据采集模式"><a href="#数据采集模式" class="headerlink" title="数据采集模式"></a>数据采集模式</h2><p>JProfier 提供两种数据采集模式 Sampling 和 Instrumentation。</p>
<ol>
<li><p>Sampling（采样） - 适合于不要求数据完全精确的场景。优点是对系统性能的影响较小，缺点是某些特性不支持（如方法级别的统计信息）</p>
</li>
<li><p>Instrumentation（仪表） - 完整功能模式，统计信息也是精确的。缺点是如果需要分析的类比较多，对应用性能影响较大。为了降低影响，往往需要和 Filter 一起使用</p>
</li>
</ol>
<h2 id="应用启动模式"><a href="#应用启动模式" class="headerlink" title="应用启动模式"></a>应用启动模式</h2><p>通过为 JProfiler agent 指定不同的参数可以控制应用的启动模式。</p>
<ol>
<li><p>等待模式 - 只有在 Jprofiler GUI 和 agent 建立连接并完成分析配置设置后，应用才会真正启动。在这种模式下，您能够获取应用启动时期的分析数据。对应的命令为-agentpath:<path to native library>=port=8849</p>
</li>
<li><p>立即启动模式 - 应用会立即启动，Jprofiler GUI 会在需要时和 agent 建立连接并设置分析配置。这种模式相对灵活，但会丢失应用启动初期的分析数据。对应的命令为-agentpath:<path to native library>=port=8849,nowait。</p>
</li>
</ol>
<h1 id="3-agentpath-VM参数-启动profiler-agent"><a href="#3-agentpath-VM参数-启动profiler-agent" class="headerlink" title="3. -agentpath VM参数 启动profiler agent"></a>3. -agentpath VM参数 启动profiler agent</h1><p>-agentpath是JVM提供的一个通用VM参数，用于加载任何一种使用JVMTI接口的本地库。 由于分析接口JVMTI是一个本地接口，所以分析代理必须是一个本地库。这意味着你只能在 明确支持的平台上进行分析。 32位和64位JVM也需要不同的本地库。另外，Java代理是用-javaagent VM参数加载的，并且只能访问有限的功能。</p>
<p>在-agentpath: 后面附加本地库的完整路径名。有一个等效参数-agentlib:， 你只需要指定特定平台的库名，但必须确保库路径中包含该库。在库的路径之后，你可以添加一个等号，并向代理传递选项，用逗号隔开。例如，在Linux上，整个参数看起来可能像这样：</p>
<blockquote>
<p>-agentpath:/opt/jprofiler10/bin/linux-x64/libjprofilerti.so=port=8849,nowait</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># jprofiler agent配置</span><br><span class="line">nohup java -agentpath:/usr/local/src/jprofiler12.0.4/bin/linux-x64/libjprofilerti.so=port=8849,nowait -jar -Xms256m -Xmx256m  ./$RESOURCE_NAME id.properties  &gt;/dev/null 2&gt;&amp;1  &amp;</span><br></pre></td></tr></table></figure>

<p>第一个等号将路径名与参数分开，第二个等号是参数port=8849 的一部分。 这个常用参数定义了分析代理监听来自JProfiler GUI连接的端口，实际上8849是默认端口，所以也可以省略这个参数。 如果你想在同一台机器上分析多个JVM，必须分配不同端口， 不过IDE插件和本地启动的会话会自动分配这个端口，对于集成向导，你必须显式选择端口。</p>
<p>第二个参数nowait告诉分析代理不要在启动时为了等待JProfiler GUI连接而阻塞JVM。 启动时的阻塞是默认的，因为分析代理不是以命令行参数的形式接收其分析设置，而是从JProfiler GUI或配置文件接收。 命令行参数仅用于引导分析代理，告诉它如何启动和传递调试标记。</p>
<p>默认情况下，JProfiler代理将通信Socket绑定到所有可用的网络接口。如果出于安全原因不希望这样做， 你可以添加选项address=[IP地址]以便选择指定接口，或loopback 只监听来自本地机器的请求。对于通过JProfiler UI启动的或通过IDE集成的JVM，会自动添加loopback</p>
<h1 id="4-jpenable-将-agent-加载到一个正在运行的-JVM-上"><a href="#4-jpenable-将-agent-加载到一个正在运行的-JVM-上" class="headerlink" title="4. jpenable 将 agent 加载到一个正在运行的 JVM 上"></a>4. jpenable 将 agent 加载到一个正在运行的 JVM 上</h1><ol>
<li><p>服务器运行 jpenable</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost bin]# ./jpenable </span><br><span class="line">选择一个 JVM:</span><br><span class="line">org.apache.catalina.startup.Bootstrap start [6221] [1]</span><br><span class="line">org.apache.catalina.startup.Bootstrap start [9791] [2]</span><br><span class="line">org.elasticsearch.bootstrap.Elasticsearch -d [11417] [3]</span><br><span class="line">agentManageInternetCard-dubbo.jar [11778] [4]</span><br><span class="line">agentManageKafka-dubbo.jar [19613] [5]</span><br><span class="line">org.apache.catalina.startup.Bootstrap start [20276] [6]</span><br><span class="line">org.apache.catalina.startup.Bootstrap start [22974] [7]</span><br><span class="line">./agentManageJob.jar [24583] [8]</span><br><span class="line">./account-Job-1.0-SNAPSHOT.jar /us...project/job/id.properties [26293] [9]</span><br><span class="line">agentManageJobOrder-dubbo.jar [26438] [10]</span><br><span class="line">sun.tools.jstatd.Jstatd -p 10000 [27456] [11]</span><br><span class="line">agentManageAccount-dubbo.jar [27463] [12]</span><br><span class="line"></span><br><span class="line">8  # 选择添加agnet的进程</span><br><span class="line"></span><br><span class="line">请选择分析模式:</span><br><span class="line">GUI模式(与 JProfiler GUI Attach) [1, 回车(Enter)]</span><br><span class="line">离线模式(使用配置文件去设置分析设置) [2]</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">请输入分析端口</span><br><span class="line">[39923]</span><br><span class="line">1234</span><br><span class="line">你现在可以使用 JProfiler GUI 连接端口 1234</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>Jprofiler ui Attach 到远程agnet</p>
</li>
</ol>
<img src="/2022/07/18/java/jvm/jprofiler/jenable.png" class="" title="jenable">

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/54274894">参考文档</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ej-technologies.com/resources/jprofiler/help_zh_CN/doc/main/architecture.html">官方帮助文档</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/18/java/jvm/javatoll/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/18/java/jvm/javatoll/" class="post-title-link" itemprop="url">JAVA自带工具命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-18 09:46:01" itemprop="dateCreated datePublished" datetime="2022-07-18T09:46:01+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tc/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JAVA-自带工具"><a href="#JAVA-自带工具" class="headerlink" title="JAVA 自带工具"></a>JAVA 自带工具</h1><ol>
<li>监控工具</li>
<li>故障排除工具</li>
<li>Java故障排除、分析、监控和管理工具</li>
<li>程方法调用(RMI)工具</li>
<li>国际化工具</li>
<li>基础工具</li>
<li>安全</li>
<li>脚本工具</li>
</ol>
<h2 id="一-监控工具"><a href="#一-监控工具" class="headerlink" title="一. 监控工具"></a>一. 监控工具</h2><ul>
<li><h3 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h3></li>
</ul>
<blockquote>
<p>JVM进程状态工具——列出目标系统上已检测的HotSpot Java虚拟机    jps [ options ] [ hostid ] </p>
</blockquote>
<blockquote>
<p>hostid -&gt; ([protocol:][[//]hostname][:port][/servername])  </p>
</blockquote>
<blockquote>
<p>protocol 默认为rmi</p>
</blockquote>
<blockquote>
<p>servername 此参数的处理取决于实现。对于优化的本地协议，该字段被忽略。对于rmi协议，该参数是一个字符串，表示远程主机上RMI远程对象的名称。请参见jstatd命令的-n选项</p>
</blockquote>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出传递给main方法的参数。对于嵌入式JVM，输出可能为空</span></span><br><span class="line">jps -m</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出传递给JVM的参数。</span></span><br><span class="line">jps -v</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务器上启动jstatd 链接远程服务器</span></span><br><span class="line">jps -v rmi://12.3.10.105:10000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出应用程序主类的完整包名或应用程序JAR文件的完整路径名。</span></span><br><span class="line">jps -l</span><br></pre></td></tr></table></figure>

<ul>
<li><h3 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h3></li>
</ul>
<blockquote>
<p>jstat [ generalOption | outputOptions vmid [interval[s|ms] [count]] ]</p>
</blockquote>
<blockquote>
<p>vmid  =&gt;  [protocol:][//]lvmid[@hostname[:port]/servername]</p>
</blockquote>
<p>一些常用的工具</p>
<blockquote>
<p>jstat -gcnew -h 3 21891 250 #年轻代统计</p>
</blockquote>
<blockquote>
<p>jstat -gcutil 21891 250 7 #gc统计信息</p>
</blockquote>
<blockquote>
<p>jstat -gcutil <a href="mailto:&#52;&#x30;&#x34;&#57;&#x36;&#64;&#x72;&#x65;&#109;&#x6f;&#x74;&#x65;&#x2e;&#100;&#x6f;&#109;&#97;&#105;&#x6e;">&#52;&#x30;&#x34;&#57;&#x36;&#64;&#x72;&#x65;&#109;&#x6f;&#x74;&#x65;&#x2e;&#100;&#x6f;&#109;&#97;&#105;&#x6e;</a> 1000 #监控远程服务</p>
</blockquote>
<ol>
<li>generalOption（常规命令行选项 statOption）</li>
</ol>
<p> 一个常规命令行选项(-help或-options)  jstat -options<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-class</span><br><span class="line">-compiler</span><br><span class="line">-gc</span><br><span class="line">-gccapacity</span><br><span class="line">-gccause</span><br><span class="line">-gcnew</span><br><span class="line">-gcnewcapacity</span><br><span class="line">-gcold</span><br><span class="line">-gcoldcapacity</span><br><span class="line">-gcpermcapacity</span><br><span class="line">-gcutil</span><br><span class="line">-printcompilation</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>outputOptions （输出格式选项）<br>一个或多个输出选项，由单个statOption加上-t、-h和-J选项组成。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-h n</span><br><span class="line"></span><br><span class="line">每n个样本(输出行)显示一个列标题，其中n是正整数。默认值为0，表示在第一行数据上方显示列标题</span><br><span class="line"></span><br><span class="line">如：jstat -gcutil -h 2 24583 1000 10 （每两行输出一下标题）</span><br><span class="line"></span><br><span class="line">-t</span><br><span class="line"></span><br><span class="line">将时间戳列显示为输出的第一列。时间戳是自目标JVM启动以来的时间。</span><br><span class="line"></span><br><span class="line">-JjavaOption</span><br><span class="line">将javaOption传递给java应用程序启动器。例如，-J-Xms48m将启动内存设置为48兆字节。有关选项的完整列表，请参见Java-Java应用程序启动器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
下表总结了jstat为每个statOption输出的列。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">-class Option  类加载统计</span><br><span class="line">Column	Description</span><br><span class="line">Loaded	Number of classes loaded.</span><br><span class="line">Bytes	Number of Kbytes loaded.</span><br><span class="line">Unloaded	Number of classes unloaded.</span><br><span class="line">Bytes	Number of Kbytes unloaded.</span><br><span class="line">Time	Time spent performing class load and unload operations.</span><br><span class="line"></span><br><span class="line">-compiler Option  HotSpot Just-In-Time Compiler Statistics JIT编译统计</span><br><span class="line">Column	Description</span><br><span class="line">Compiled	Number of compilation tasks performed.</span><br><span class="line">Failed	Number of compilation tasks that failed.</span><br><span class="line">Invalid	Number of compilation tasks that were invalidated.</span><br><span class="line">Time	Time spent performing compilation tasks.</span><br><span class="line">FailedType	Compile type of the last failed compilation.</span><br><span class="line">FailedMethod	Class name and method for the last failed compilation.</span><br><span class="line"></span><br><span class="line">-gc Option 垃圾收集的堆统计信息</span><br><span class="line">Column	Description</span><br><span class="line">S0C	Current survivor space 0 capacity (KB).</span><br><span class="line">S1C	Current survivor space 1 capacity (KB).</span><br><span class="line">S0U	Survivor space 0 utilization (KB).</span><br><span class="line">S1U	Survivor space 1 utilization (KB).</span><br><span class="line">EC	Current eden space capacity (KB).</span><br><span class="line">EU	Eden space utilization (KB).</span><br><span class="line">OC	Current old space capacity (KB).</span><br><span class="line">OU	Old space utilization (KB).</span><br><span class="line">PC	Current permanent space capacity (KB).</span><br><span class="line">PU	Permanent space utilization (KB).</span><br><span class="line">YGC	Number of young generation GC Events.</span><br><span class="line">YGCT	Young generation garbage collection time.</span><br><span class="line">FGC	Number of full GC events.</span><br><span class="line">FGCT	Full garbage collection time.</span><br><span class="line">GCT	Total garbage collection time.</span><br><span class="line"></span><br><span class="line">-gccapacity Option  各代内存池和空间容量</span><br><span class="line">Column	Description</span><br><span class="line">NGCMN	Minimum new generation capacity (KB).</span><br><span class="line">NGCMX	Maximum new generation capacity (KB).</span><br><span class="line">NGC	Current new generation capacity (KB).</span><br><span class="line">S0C	Current survivor space 0 capacity (KB).</span><br><span class="line">S1C	Current survivor space 1 capacity (KB).</span><br><span class="line">EC	Current eden space capacity (KB).</span><br><span class="line">OGCMN	Minimum old generation capacity (KB).</span><br><span class="line">OGCMX	Maximum old generation capacity (KB).</span><br><span class="line">OGC	Current old generation capacity (KB).</span><br><span class="line">OC	Current old space capacity (KB).</span><br><span class="line">PGCMN	Minimum permanent generation capacity (KB).</span><br><span class="line">PGCMX	Maximum Permanent generation capacity (KB).</span><br><span class="line">PGC	Current Permanent generation capacity (KB).</span><br><span class="line">PC	Current Permanent space capacity (KB).</span><br><span class="line">YGC	Number of Young generation GC Events.</span><br><span class="line">FGC	Number of Full GC Events.</span><br><span class="line"></span><br><span class="line">-gccause Option  该选项显示与-gcutil选项相同的垃圾收集统计信息摘要，但包括上次垃圾收集事件的原因和(如果适用)当前垃圾收集事件。除了为-gcutil列出的列之外，该选项还添加了以下列:</span><br><span class="line"></span><br><span class="line">Garbage Collection Statistics, Including GC Events</span><br><span class="line">Column	Description</span><br><span class="line">LGCC	Cause of last Garbage Collection.</span><br><span class="line">GCC	Cause of current Garbage Collection.</span><br><span class="line"></span><br><span class="line">-gcnew Option 年轻代统计信息</span><br><span class="line">Column	Description</span><br><span class="line">S0C	Current survivor space 0 capacity (KB).</span><br><span class="line">S1C	Current survivor space 1 capacity (KB).</span><br><span class="line">S0U	Survivor space 0 utilization (KB).</span><br><span class="line">S1U	Survivor space 1 utilization (KB).</span><br><span class="line">TT	Tenuring threshold.</span><br><span class="line">MTT	Maximum tenuring threshold.</span><br><span class="line">DSS	Desired survivor size (KB).</span><br><span class="line">EC	Current eden space capacity (KB).</span><br><span class="line">EU	Eden space utilization (KB).</span><br><span class="line">YGC	Number of young generation GC events.</span><br><span class="line">YGCT	Young generation garbage collection time.</span><br><span class="line"></span><br><span class="line">-gcnewcapacity Option  年轻代空间统计</span><br><span class="line">Column	Description</span><br><span class="line">NGCMN</span><br><span class="line">Minimum new generation capacity (KB).</span><br><span class="line">NGCMX	Maximum new generation capacity (KB).</span><br><span class="line">NGC	Current new generation capacity (KB).</span><br><span class="line">S0CMX	Maximum survivor space 0 capacity (KB).</span><br><span class="line">S0C	Current survivor space 0 capacity (KB).</span><br><span class="line">S1CMX	Maximum survivor space 1 capacity (KB).</span><br><span class="line">S1C	Current survivor space 1 capacity (KB).</span><br><span class="line">ECMX	Maximum eden space capacity (KB).</span><br><span class="line">EC	Current eden space capacity (KB).</span><br><span class="line">YGC	Number of young generation GC events.</span><br><span class="line">FGC	Number of Full GC Events.</span><br><span class="line"></span><br><span class="line">-gcold Option 来年代和永久代统计信息</span><br><span class="line">Column	Description</span><br><span class="line">PC	Current permanent space capacity (KB).</span><br><span class="line">PU	Permanent space utilization (KB).</span><br><span class="line">OC	Current old space capacity (KB).</span><br><span class="line">OU	old space utilization (KB).</span><br><span class="line">YGC	Number of young generation GC events.</span><br><span class="line">FGC	Number of full GC events.</span><br><span class="line">FGCT	Full garbage collection time.</span><br><span class="line">GCT	Total garbage collection time.</span><br><span class="line"></span><br><span class="line">-gcoldcapacity Option 老年代统计</span><br><span class="line">Column	Description</span><br><span class="line">OGCMN	Minimum old generation capacity (KB).</span><br><span class="line">OGCMX	Maximum old generation capacity (KB).</span><br><span class="line">OGC	Current old generation capacity (KB).</span><br><span class="line">OC	Current old space capacity (KB).</span><br><span class="line">YGC	Number of young generation GC events.</span><br><span class="line">FGC	Number of full GC events.</span><br><span class="line">FGCT	Full garbage collection time.</span><br><span class="line">GCT	Total garbage collection time.</span><br><span class="line"></span><br><span class="line">-gcpermcapacity Option 永久代统计</span><br><span class="line">Column	Description</span><br><span class="line">PGCMN	Minimum permanent generation capacity (KB).</span><br><span class="line">PGCMX	Maximum permanent generation capacity (KB).</span><br><span class="line">PGC	Current permanent generation capacity (KB).</span><br><span class="line">PC	Current permanent space capacity (KB).</span><br><span class="line">YGC	Number of young generation GC events.</span><br><span class="line">FGC	Number of full GC events.</span><br><span class="line">FGCT	Full garbage collection time.</span><br><span class="line">GCT	Total garbage collection time.</span><br><span class="line"></span><br><span class="line">-gcutil Option 垃圾收集统计信息摘要</span><br><span class="line">Column	Description</span><br><span class="line">S0	Survivor space 0 utilization as a percentage of the space&#x27;s current capacity.</span><br><span class="line">S1	Survivor space 1 utilization as a percentage of the space&#x27;s current capacity.</span><br><span class="line">E	Eden space utilization as a percentage of the space&#x27;s current capacity.</span><br><span class="line">O	Old space utilization as a percentage of the space&#x27;s current capacity.</span><br><span class="line">P	Permanent space utilization as a percentage of the space&#x27;s current capacity.</span><br><span class="line">YGC	Number of young generation GC events.</span><br><span class="line">YGCT	Young generation garbage collection time.</span><br><span class="line">FGC	Number of full GC events.</span><br><span class="line">FGCT	Full garbage collection time.</span><br><span class="line">GCT	Total garbage collection time.</span><br><span class="line"></span><br><span class="line">-printcompilation Option HotSpot Compiler Method Statistics 方法统计</span><br><span class="line">Column	Description</span><br><span class="line">Compiled	Number of compilation tasks performed by the most recently compiled method.</span><br><span class="line">Size	Number of bytes of bytecode of the most recently compiled method.</span><br><span class="line">Type	Compilation type of the most recently compiled method.</span><br><span class="line">Method	Class name and method name identifying the most recently compiled method. Class name uses &quot;/&quot; instead of &quot;.&quot; as namespace separator. Method name is the method within the given class. The format for these two fields is consistent with the HotSpot - XX:+PrintComplation option.</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><h3 id="jstatd"><a href="#jstatd" class="headerlink" title="jstatd"></a>jstatd</h3></li>
</ul>
<p>JVM jstat Daemon——启动RMI服务器应用程序，该应用程序监视被检测的HotSpot Java虚拟机的创建和终止，并提供一个接口，允许远程监视工具连接到在本地系统上运行的Java虚拟机。</p>
<h2 id="二-故障排除工具"><a href="#二-故障排除工具" class="headerlink" title="二. 故障排除工具"></a>二. 故障排除工具</h2><ul>
<li><h3 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h3></li>
</ul>
<p>jinfo打印给定Java进程或核心文件或远程调试服务器的Java配置信息。配置信息包括Java系统属性和Java虚拟机命令行标志。</p>
<p>如果给定的进程在64位虚拟机上运行，您可能需要指定-J-d64选项，例如: jinfo -J-d64 -sysprops pid</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost bin]# ./jinfo -flags 27463</span><br><span class="line">Attaching to process ID 27463, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.172-b11</span><br><span class="line">Non-default VM flags: -XX:CICompilerCount=3 -XX:InitialHeapSize=268435456 -XX:MaxHeapSize=536870912 -XX:MaxNewSize=178782208 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=89128960 -XX:OldSize=179306496 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC </span><br><span class="line">Command line:  -Xms256m -Xmx512m</span><br><span class="line"></span><br><span class="line">#查看某个flag</span><br><span class="line">[root@localhost bin]# ./jinfo -flag CICompilerCount 27463</span><br><span class="line">-XX:CICompilerCount=3</span><br><span class="line"></span><br><span class="line">#修改某个配置项值</span><br><span class="line">[root@localhost bin]# ./jinfo -flag CICompilerCount=4 27463</span><br><span class="line">#将配置项修改为false 禁用配置</span><br><span class="line">[root@localhost bin]# ./jinfo -flag -UseParallelGC 27463</span><br><span class="line">#将配置项修改为true 启用配置</span><br><span class="line">[root@localhost bin]# ./jinfo -flag +UseParallelGC 27463</span><br><span class="line"></span><br><span class="line">#查看jvm配置信息， 环境配置，系统配置 </span><br><span class="line">[root@localhost bin]# ./jinfo 27463</span><br><span class="line">Attaching to process ID 27463, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.172-b11</span><br><span class="line">Java System Properties:</span><br><span class="line"></span><br><span class="line">java.runtime.name = Java(TM) SE Runtime Environment</span><br><span class="line">java.vm.version = 25.172-b11</span><br><span class="line">sun.boot.library.path = /usr/local/src/jdk/jre/lib/amd64</span><br><span class="line">java.vendor.url = http://java.oracle.com/</span><br><span class="line">java.vm.vendor = Oracle Corporation</span><br><span class="line">path.separator = :</span><br><span class="line">file.encoding.pkg = sun.io</span><br><span class="line">java.vm.name = Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line">sun.os.patch.level = unknown</span><br><span class="line">sun.java.launcher = SUN_STANDARD</span><br><span class="line">user.country = CN</span><br><span class="line">user.dir = /usr/local/agentManageAccount-dubbo/releases/20220406-170930</span><br><span class="line">java.vm.specification.name = Java Virtual Machine Specification</span><br><span class="line">java.runtime.version = 1.8.0_172-b11</span><br><span class="line">java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment</span><br><span class="line">os.arch = amd64</span><br><span class="line">java.endorsed.dirs = /usr/local/src/jdk/jre/lib/endorsed</span><br><span class="line">java.io.tmpdir = /tmp</span><br><span class="line">line.separator = </span><br><span class="line"></span><br><span class="line">java.vm.specification.vendor = Oracle Corporation</span><br><span class="line">os.name = Linux</span><br><span class="line">sun.jnu.encoding = UTF-8</span><br><span class="line">java.library.path = /usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">java.specification.name = Java Platform API Specification</span><br><span class="line">java.class.version = 52.0</span><br><span class="line">sun.management.compiler = HotSpot 64-Bit Tiered Compilers</span><br><span class="line">os.version = 2.6.32-431.el6.x86_64</span><br><span class="line">user.home = /root</span><br><span class="line">user.timezone = PRC</span><br><span class="line">java.awt.printerjob = sun.print.PSPrinterJob</span><br><span class="line">file.encoding = UTF-8</span><br><span class="line">java.specification.version = 1.8</span><br><span class="line">user.name = root</span><br><span class="line">java.class.path = agentManageAccount-dubbo.jar</span><br><span class="line">java.vm.specification.version = 1.8</span><br><span class="line">sun.arch.data.model = 64</span><br><span class="line">sun.java.command = agentManageAccount-dubbo.jar</span><br><span class="line">java.home = /usr/local/src/jdk/jre</span><br><span class="line">user.language = zh</span><br><span class="line">java.specification.vendor = Oracle Corporation</span><br><span class="line">awt.toolkit = sun.awt.X11.XToolkit</span><br><span class="line">java.vm.info = mixed mode</span><br><span class="line">java.version = 1.8.0_172</span><br><span class="line">java.ext.dirs = /usr/local/src/jdk/jre/lib/ext:/usr/java/packages/lib/ext</span><br><span class="line">sun.boot.class.path = /usr/local/src/jdk/jre/lib/resources.jar:/usr/local/src/jdk/jre/lib/rt.jar:/usr/local/src/jdk/jre/lib/sunrsasign.jar:/usr/local/src/jdk/jre/lib/jsse.jar:/usr/local/src/jdk/jre/lib/jce.jar:/usr/local/src/jdk/jre/lib/charsets.jar:/usr/local/src/jdk/jre/lib/jfr.jar:/usr/local/src/jdk/jre/classes</span><br><span class="line">java.vendor = Oracle Corporation</span><br><span class="line">file.separator = /</span><br><span class="line">java.vendor.url.bug = http://bugreport.sun.com/bugreport/</span><br><span class="line">sun.io.unicode.encoding = UnicodeLittle</span><br><span class="line">sun.cpu.endian = little</span><br><span class="line">sun.cpu.isalist = </span><br><span class="line"></span><br><span class="line">VM Flags:</span><br><span class="line">Non-default VM flags: -XX:CICompilerCount=3 -XX:InitialHeapSize=268435456 -XX:MaxHeapSize=536870912 -XX:MaxNewSize=178782208 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=89128960 -XX:OldSize=179306496 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC </span><br><span class="line">Command line:  -Xms256m -Xmx512m</span><br></pre></td></tr></table></figure>

<ul>
<li><h3 id="jhat"><a href="#jhat" class="headerlink" title="jhat"></a>jhat</h3>堆转储浏览器-在堆转储文件(例如，由jmap -dump生成的文件)上启动web服务器，允许浏览堆。</li>
</ul>
<blockquote>
<p>使用 jhat file 查看。</p>
</blockquote>
<ul>
<li><h3 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h3><p>打印给定进程或核心文件或远程调试服务器的共享对象内存映射或堆内存细节。</p>
</li>
<li><h3 id="jsadebugd"><a href="#jsadebugd" class="headerlink" title="jsadebugd"></a>jsadebugd</h3></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jsadebugd pid [ server-id ]</span><br><span class="line">jsadebugd executable core [ server-id ]</span><br></pre></td></tr></table></figure>
<p>Java可服务性代理调试守护进程——附加到进程或核心文件，并充当调试服务器。</p>
<p>&nbsp;&nbsp;使用jinfo，jmap，jstack命令不仅可监控本地主机上的JVM进程，也可监控远端主机上的JVM进程，前者称为“本地模式”，后者称为“联网模式”。“联网模式”下的整个监控体系实质上是一个RMI应用程序。在“联网模式”下，一般情况下，远端主机上“运行rmiregistry服务，运行RMI Server”，本地主机上“运行RMI Client”，整个体系中“无需运行Web Server服务（因为所有相关类都可在本地获取）”。</p>
<p>&nbsp;&nbsp;如果rmiregistry没有启动，jsadebugd将在标准(1099)端口内部启动rmiregistry。可以通过向调试服务器发送SIGINT(按Ctrl-C)来停止调试服务器。</p>
<p>&nbsp;&nbsp;在远端主机上，通过运行jsadebugd命令开启RMI Server（需要注意的是，运行jsadebugd命令同时会自动运行rmiregistry服务，而无需手动运行），使用“PID”选项值指定远端主机上待被监控的JVM进程ID，使用“ServerId”选项值作为RMI Server内向rmiregistry服务注册所生成Remote Object实例的名称（如果未指定，则使用默认名称）；在本地主机上，运行jinfo，jmap，jstack命令作为RMI Client</p>
<blockquote>
<p>在远端主机上，执行jsadebugd -J-Djava.rmi.server.hostname=12.3.10.105 pid serviceID 命令开启RMI Server（同时开启rmiregistry服务），并使用“remoteObject1”名称向rmiregistry服务注册所生成的Remote Object实例</p>
</blockquote>
<blockquote>
<p>在本地主机上，执行jinfo/jmap/jstack <a href="mailto:&#115;&#101;&#x72;&#x76;&#x69;&#x63;&#101;&#73;&#x44;&#64;&#114;&#x65;&#109;&#111;&#116;&#101;&#115;&#x65;&#114;&#x76;&#x65;&#114;&#x2e;&#x68;&#x6f;&#115;&#x74;">&#115;&#101;&#x72;&#x76;&#x69;&#x63;&#101;&#73;&#x44;&#64;&#114;&#x65;&#109;&#111;&#116;&#101;&#115;&#x65;&#114;&#x76;&#x65;&#114;&#x2e;&#x68;&#x6f;&#115;&#x74;</a> 命令作为RMI Client与远端主机上的rmiregistry服务和RMI Server进行交互，而达到监控远端主机上相应JVM进程的目标。执行jinfo，jmap，jstack命令时可使用的选项参数可具体参考这些命令的“本地模式”用法</p>
</blockquote>
<ul>
<li><h3 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h3>打印给定进程或核心文件或远程调试服务器的线程堆栈跟踪。</li>
</ul>
<h2 id="三-Java故障排除、分析、监控和管理工具"><a href="#三-Java故障排除、分析、监控和管理工具" class="headerlink" title="三. Java故障排除、分析、监控和管理工具"></a>三. Java故障排除、分析、监控和管理工具</h2><ul>
<li>###jcmd</li>
</ul>
<p>JVM诊断命令工具——向正在运行的Java虚拟机发送诊断命令请求。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jcmd [ options ]</span><br><span class="line"></span><br><span class="line">jcmd [ pid | main-class ] PerfCounter.print</span><br><span class="line"></span><br><span class="line">jcmd [ pid | main-class ] command [ arguments ]</span><br><span class="line"></span><br><span class="line">jcmd [ pid | main-class ] -f file</span><br></pre></td></tr></table></figure>

<blockquote>
<p>./jcmd -l #打印正在运行的Java进程及其进程id、主类和命令行参数的列表。<br>./jcmd 1055 help #查看进程1055可执行的命令 ，获取结果如下:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1055:</span><br><span class="line">The following commands are available:</span><br><span class="line">JFR.stop</span><br><span class="line">JFR.start</span><br><span class="line">JFR.dump</span><br><span class="line">JFR.check</span><br><span class="line">VM.native_memory</span><br><span class="line">VM.check_commercial_features</span><br><span class="line">VM.unlock_commercial_features</span><br><span class="line">ManagementAgent.stop</span><br><span class="line">ManagementAgent.start_local</span><br><span class="line">ManagementAgent.start</span><br><span class="line">VM.classloader_stats</span><br><span class="line">GC.rotate_log</span><br><span class="line">Thread.print</span><br><span class="line">GC.class_stats</span><br><span class="line">GC.class_histogram</span><br><span class="line">GC.heap_dump</span><br><span class="line">GC.finalizer_info</span><br><span class="line">GC.heap_info</span><br><span class="line">GC.run_finalization</span><br><span class="line">GC.run</span><br><span class="line">VM.uptime</span><br><span class="line">VM.dynlibs</span><br><span class="line">VM.flags</span><br><span class="line">VM.system_properties</span><br><span class="line">VM.command_line</span><br><span class="line">VM.version</span><br><span class="line">help</span><br></pre></td></tr></table></figure>
<blockquote>
<p>./jcmd 1055 GC.run #对进程1055 pid 执行GC.run 命令</p>
</blockquote>
<ul>
<li>###jconsole</li>
</ul>
<p>一个符合JMX标准的图形化工具，用于监控Java虚拟机。它可以监控本地和远程JVM。它还可以监控和管理应用程序。 有关更多信息，请参见Java平台的监控和管理。</p>
<ul>
<li>###jmc</li>
</ul>
<p>Java Mission Control (JMC)客户端包括监控和管理Java应用程序的工具，而不会引入通常与这些类型的工具相关的性能开销。</p>
<ul>
<li>###jvisualvm</li>
</ul>
<p>一个图形工具，当基于Java技术的应用程序(Java应用程序)在Java虚拟机中运行时，它提供有关这些应用程序的详细信息。Java VisualVM提供内存和CPU分析、堆转储分析、内存泄漏检测、MBeans访问和垃圾收集。有关更多信息，请参见Java VisualVM。</p>
<h2 id="四-程方法调用-RMI-工具"><a href="#四-程方法调用-RMI-工具" class="headerlink" title="四. 程方法调用(RMI)工具"></a>四. 程方法调用(RMI)工具</h2><h2 id="五-国际化工具"><a href="#五-国际化工具" class="headerlink" title="五. 国际化工具"></a>五. 国际化工具</h2><ul>
<li>###native2ascii</li>
</ul>
<blockquote>
<p>JAVA_HOME\bin\native2ascii -encoding GBK D:\src\resources.properties D:\classes\resources.properties</p>
</blockquote>
<p>native2ascii [options] [inputfile [outputfile]]</p>
<p>options：</p>
<p>-reverse</p>
<p>执行相反的操作:将采用Unicode转义的ISO-8859-1编码的文件转换为Java运行时环境支持的任何字符编码的文件</p>
<p>-encoding encoding_name</p>
<p>指定转换过程要使用的字符编码的名称。如果该选项不存在，则使用默认的字符编码(由Java.nio.charset.charset.default charset方法确定)。encoding_name字符串必须是Java运行时环境支持的字符编码的名称，<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/technotes/guides/intl/encoding.doc.html">请参见支持的编码文档。</a></p>
<p>-Joption</p>
<p>将option传递给java虚拟机，其中option是Java应用程序启动程序参考页上描述的选项之一。例如，-J-Xms48m将启动内存设置为48兆字节</p>
<h2 id="六-基础工具"><a href="#六-基础工具" class="headerlink" title="六. 基础工具"></a>六. 基础工具</h2><h2 id="七-安全"><a href="#七-安全" class="headerlink" title="七. 安全"></a>七. 安全</h2><h2 id="八-脚本工具"><a href="#八-脚本工具" class="headerlink" title="八. 脚本工具"></a>八. 脚本工具</h2><p>jrunscript是一个命令行脚本shell。jrunscript支持交互式(读取-评估-打印)模式和批处理(-f选项)模式的脚本执行。这是一个脚本语言独立的外壳。默认情况下，JavaScript是使用的语言，但是-l选项可以用于指定不同的语言。通过Java到脚本语言的通信，jrunscript支持“探索性编程”风格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jrunscript</span><br><span class="line">js&gt; print(&#x27;Hello World\n&#x27;);</span><br><span class="line">Hello World</span><br><span class="line">js&gt; 34 + 55</span><br><span class="line">89.0</span><br><span class="line">js&gt; t = new java.lang.Thread(function() &#123; print(&#x27;Hello World\n&#x27;); &#125;)</span><br><span class="line">Thread[Thread-0,5,main]</span><br><span class="line">js&gt; t.start()</span><br><span class="line">js&gt; Hello World</span><br><span class="line"></span><br><span class="line">js&gt;</span><br></pre></td></tr></table></figure>

<p> <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/technotes/tools/share/jrunscript.html">参考文档</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/14/java/jvm/monitortool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/14/java/jvm/monitortool/" class="post-title-link" itemprop="url">JVM监控工具</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-14 21:00:46" itemprop="dateCreated datePublished" datetime="2022-07-14T21:00:46+08:00">2022-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tc/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JVM运行监控"><a href="#JVM运行监控" class="headerlink" title="JVM运行监控"></a>JVM运行监控</h1><ol>
<li>java自带工具命令</li>
<li>Eclipse Memory Analyzer</li>
<li>JMX Jstatd - Jconsole VisualVm</li>
<li>Btrace </li>
<li>火焰图</li>
<li>Flight Recorder  JavaMissionControl</li>
<li>JProfiler</li>
</ol>
<blockquote>
<p>监控整个集群的各项资源的使用情况以及各个服务的存活情况</p>
</blockquote>
<blockquote>
<p>监控代码问题导致的线程死锁，OOM</p>
</blockquote>
<h1 id="JMX-Jstatd-服务及Jconsole-VisualVm"><a href="#JMX-Jstatd-服务及Jconsole-VisualVm" class="headerlink" title="JMX Jstatd 服务及Jconsole VisualVm"></a>JMX Jstatd 服务及Jconsole VisualVm</h1><ol>
<li><p>JMX:使用JMX需要远程JVM在启动的时候开启远程访问支持，设定JMX端口等，每一个JMX连接一个远程JVM。</p>
</li>
<li><p>JStatD:使用jstatd连接方式时，需要在远程主机上创建安全策略文件然后启动jstatd进程，并且此进程需要一直保持运行状态,<strong>客户端可以看到远程主机上当前用户的所有JVM的信息</strong>，即只要创建一个jstatd连接</p>
</li>
</ol>
<h2 id="JMX方式"><a href="#JMX方式" class="headerlink" title="JMX方式"></a>JMX方式</h2><p>JMX，是Java Management Extensions(Java管理扩展)的缩写，是一个为应用程序植入管理功能的框架。用户可以在任何Java应用程序中使用这些代理和服务实现管理（Mbean）</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/technotes/guides/management/agent.html#:~:text=Using%20File-Based%20Password%20Authentication%201%20Copy%20the%20password,and%20rename%20it%20to%20jmxremote.password.%20More%20items...%20">管方说明</a></p>
<img src="/2022/07/14/java/jvm/monitortool/jmxstracture.jpg" class="" title="JMX架构">

<h3 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h3><table>
<thead>
<tr>
<th align="left">配置</th>
<th align="left">功能</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-Dcom.sun.management.jmxremote=true</td>
<td align="left">相关 JMX 代理侦听开关</td>
<td align="left">true / false. Default is true.</td>
</tr>
<tr>
<td align="left">-Djava.rmi.server.hostname</td>
<td align="left">服务器端的IP</td>
<td align="left">服务ip</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.rmi.port=1000</td>
<td align="left">rmi端口</td>
<td align="left">默认随机</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.port=29094</td>
<td align="left">相关 JMX 代理侦听请求的端口</td>
<td align="left">Port number. No default.</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.authenticate=false</td>
<td align="left">指定是否需要密码验证</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.password.file=JRE_HOME/lib/management/jmxremote.password</td>
<td align="left">密码认证文件，可自行指定，不指定在默认位置</td>
<td align="left">JRE_HOME/lib/management/ jmxremote.password</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.access.file=JRE_HOME/lib/management/jmxremote.access</td>
<td align="left">权限控制文件，可自行指定，不指定在默认位置</td>
<td align="left">JRE_HOME/lib/management/jmxremote.access</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.ssl</td>
<td align="left">指定是否使用 SSL 通讯</td>
<td align="left">true / false. Default is true.</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.registry.ssl</td>
<td align="left">Binds the RMI connector stub to an RMI registry protected by SSL.</td>
<td align="left">true / false. Default is false.</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.ssl.enabled.protocols</td>
<td align="left">A comma-delimited list of SSL/TLS protocol versions to enable. Used in conjunction with com.sun.management.jmxremote.ssl.</td>
<td align="left">Default SSL/TLS protocol version.</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.ssl.enabled.cipher.suitese</td>
<td align="left">A comma-delimited list of SSL/TLS cipher suites to enable. Used in conjunction with com.sun.management.jmxremote.ssl.</td>
<td align="left">Default SSL/TLS cipher suites.</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.ssl.need.client.auth</td>
<td align="left">If this property is true and the property com.sun.management.jmxremote.ssl is also true, then client authentication will be performed. It is recommended that you set this property to true.</td>
<td align="left">true / false. Default is false.</td>
</tr>
<tr>
<td align="left">-Dcom.sun.management.jmxremote.login.config</td>
<td align="left">Specifies the name of a Java Authentication and Authorization Service (JAAS) login configuration entry to use when the JMX agent authenticates users. When using this property to override the default login configuration, the named configuration entry must be in a file that is loaded by JAAS. In addition, the login modules specified in the configuration should use the name and password callbacks to acquire the user’s credentials. For more information, see the API documentation for javax.security.auth.callback.NameCallback and javax.security.auth.callback.PasswordCallback.</td>
<td align="left">Default login configuration is a file-based password authentication.</td>
</tr>
</tbody></table>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=&quot;</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">JAVA_OPTS</span> </span><br><span class="line">-Djava.rmi.server.hostname=127.0.0.1</span><br><span class="line">-Dcom.sun.management.jmxremote.port=10000       </span><br><span class="line">-Dcom.sun.management.jmxremote.ssl=false    # Disabling SSL</span><br><span class="line">-Dcom.sun.management.jmxremote.authenticate=true # Disabling Security</span><br><span class="line">&quot;</span><br></pre></td></tr></table></figure>

<p>远程监控和管理需要安全性，以确保未经授权的人无法控制或监控您的应用程序。默认情况下，启用安全套接字层(SSL)和传输层安全性(TLS)上的密码身份验证。您可以分别禁用密码验证和SSL    </p>
<h3 id="密码认证"><a href="#密码认证" class="headerlink" title="密码认证"></a>密码认证</h3><p>JMX支持多种认证方式 使用LDAP认证，基于文件的密码认证，也可以禁用密码认证</p>
<h5 id="禁用密码及禁用ssl"><a href="#禁用密码及禁用ssl" class="headerlink" title="禁用密码及禁用ssl"></a>禁用密码及禁用ssl</h5><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Dcom.sun.management.jmxremote.ssl=false    # Disabling SSL</span><br><span class="line">-Dcom.sun.management.jmxremote.authenticate=false # Disabling Security</span><br></pre></td></tr></table></figure>

<h5 id="基于文件的密码认证"><a href="#基于文件的密码认证" class="headerlink" title="基于文件的密码认证"></a>基于文件的密码认证</h5><p><strong>环境类型</strong></p>
<ol>
<li>单用户环境</li>
</ol>
<p>To Set up a Single-User Environment</p>
<p>You set up the password file in the JRE_HOME/lib/management directory as follows.</p>
<p>Copy the password template file, jmxremote.password.template, to jmxremote.password.</p>
<p>Set file permissions so that only the owner can read and write the password file.</p>
<p>Add passwords for roles such as monitorRole and controlRole.</p>
<ol start="2">
<li>多用户环境<br>To Set up a Multiple-User Environment</li>
</ol>
<p>You set up the password file in the JRE_HOME/lib/management directory as follows.</p>
<p>Copy the password template file, jmxremote.password.template, to your home directory and rename it to jmxremote.password.</p>
<p>Set file permissions so that only you can read and write the password file.</p>
<p>Add passwords for the roles such as monitorRole and controlRole.</p>
<p>Set the following system property when you start the Java VM.</p>
<p>com.sun.management.jmxremote.password.file=pwFilePath</p>
<p>In the above property, pwFilePath is the path to the password file.</p>
<p><strong>文件配置</strong><br>密码文件定义了不同的角色及其密码。访问控制文件(默认为jmxremote.access)定义了每个角色允许的访问权限。要发挥作用，角色必须在密码和访问文件中都有一个条目。</p>
<ol>
<li>密码文件 </li>
</ol>
<ul>
<li><p>模板文件位置 jdk/jre/lib/management/jmxremote.password.template</p>
</li>
<li><p>拷贝template文件到 JRE_HOME/lib/management/jmxremote.password 或者 你的用户目录, 为文件里的角色添加密码</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># specify actual password instead of the text password</span><br><span class="line">monitorRole password</span><br><span class="line">controlRole password</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 jmxremote.password</span><br></pre></td></tr></table></figure>

<p><em><strong>您必须确保只有所有者拥有该文件的读写权限，因为它包含明文形式的密码。出于安全原因，系统会检查文件是否只对所有者可读，如果不可读，则返回错误退出。因此，在多用户环境中，您应该将密码文件存储在私有位置，如您的主目录</strong></em></p>
<ol start="2">
<li>访问控制文件</li>
</ol>
<ul>
<li><p>访问文件定义了角色及其访问级别。默认情况下，access文件定义了以下两个主要角色。</p>
<p> monitorRole, 它授予监视的只读访问权限</p>
<p> controlRole, 它授予监视和管理的读写权限</p>
</li>
<li><p>访问控制条目由角色名称和关联的访问级别组成。角色名不能包含空格或制表符，并且必须对应于密码文件中的条目。访问级别可以是下列之一。</p>
<p> readonly,   它授予读取MBean属性的权限。对于监控，这意味着这个角色的远程客户端可以读取测量值，但是不能执行任何改变运行程序环境的操作。远程客户端也可以监听MBean通知    </p>
<p> readwrite, 它授予读取和写入MBean属性、调用对它们的操作以及创建或删除它们的权限。这种访问应该只授予受信任的客户端，因为它们可能会干扰应用程序的操作。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># The &quot;monitorRole&quot; role has readonly access.</span><br><span class="line"># The &quot;controlRole&quot; role has readwrite access.</span><br><span class="line">monitorRole readonly</span><br><span class="line">controlRole readwrite</span><br></pre></td></tr></table></figure>

<p><em><strong>默认情况下，access文件命名为jmxremote.access。属性名是来自与密码文件相同空间的标识。关联的值必须是readonly或readwrite。</strong></em></p>
<blockquote>
<p>注意:</p>
</blockquote>
<blockquote>
<p>可以在management.properties文件中指定 com.sun.management.jmxremote.* 属性，而不是在命令行中传递它们。<br>在这种情况下，需要系统属性-Dcom.sun.management.config.file=management.properties来指定management . properties文件的位置</p>
</blockquote>
<h2 id="Jstatd-方式"><a href="#Jstatd-方式" class="headerlink" title="Jstatd 方式"></a>Jstatd 方式</h2><p>jstatd工具是一个RMI服务器应用程序，它监视被检测的HotSpot Java虚拟机(JVM)的创建和终止，并提供一个接口，允许远程监视工具连接到在本地主机上运行的JVM</p>
<p>jstatd服务器要求本地主机上存在RMI注册表。jstatd服务器将尝试在默认端口或-p port选项指示的端口上连接到RMI注册表。如果没有找到RMI注册中心，将在jstatd应用程序中创建一个，绑定到-p port选项指定的端口，或者如果省略-p port，则绑定到默认的RMI注册中心端口。可以通过指定-nr选项来禁止创建内部RMI注册表。</p>
<blockquote>
<p>注册表其实不用写任何代码，在你的JAVA_HOME下bin目录下有一个rmiregistry程序，需要在你的程序的classpath下运行该程序</p>
</blockquote>
<h3 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h3><ul>
<li>-nr</li>
</ul>
<p>如果没有找到现有的RMI注册中心，不要试图在jstatd进程中创建内部RMI注册中心</p>
<ul>
<li>-p  port</li>
</ul>
<p>期望在其中找到RMI注册表的端口号，或者，如果没有找到，则在没有指定-nr的情况下创建。</p>
<ul>
<li>-n  rminame</li>
</ul>
<p>远程RMI对象在RMI注册表中绑定到的名称。默认名称为JStatRemoteHost。如果在同一台主机上启动了多个jstatd服务器，那么通过指定这个选项，可以使每个服务器的导出RMI对象的名称是唯一的。但是，这样做需要在监控客户端的hostid和vmid字符串中包含唯一的服务器名称</p>
<ul>
<li>-Joption</li>
</ul>
<p>将选项传递给javac调用的java启动器。例如，-J-Xms48m将启动内存设置为48兆字节。对于-J来说，将选项传递给执行用Java编写的应用程序的底层VM是一个常见的约定。</p>
<h3 id="安全配置"><a href="#安全配置" class="headerlink" title="安全配置"></a>安全配置</h3><p>jstatd服务器只能监视它拥有适当的本地访问权限的JVM。因此，jstatd进程必须使用与目标JVM相同的用户凭证运行。一些用户凭证，例如基于UNIX的系统中的root用户，有权访问系统上任何JVM导出的工具。使用这种凭证运行的jstatd进程可以监控系统上的任何JVM，但是会引入额外的安全问题。</p>
<p>jstatd服务器不提供任何远程客户端的身份验证。因此，运行jstatd服务器进程会向网络上的任何用户公开jstatd进程对其拥有访问权限的所有JVM的检测导出。这种暴露在您的环境中可能是不希望的，在启动jstatd进程之前应该考虑本地安全策略，尤其是在生产环境或不安全的网络中</p>
<p>如果没有安装其他安全管理器，jstatd服务器将安装RMISecurityPolicy的实例，因此需要指定安全策略文件。策略文件必须符合默认策略实现的策略文件语法</p>
<p>以下策略文件将允许jstatd服务器在没有任何安全异常的情况下运行。与授予所有代码库所有权限相比，此策略不够自由，但比授予运行jstatd服务器的最低权限的策略更自由。</p>
<ul>
<li><p>jstatd -J-Djava.security.policy=jstatd.all.policy</p>
</li>
<li><p>文件位置  jdk/bin/jstatd.all.policy</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grant codebase &quot;file:$&#123;java.home&#125;/../lib/tools.jar&quot; &#123;</span><br><span class="line">   permission java.security.AllPermission;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h3><ul>
<li>使用内部RMI注册表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstatd -J-Djava.security.policy=all.policy</span><br></pre></td></tr></table></figure>

<ul>
<li>使用外部注册表</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">rmiregistry&amp;</span><br><span class="line">jstatd -J-Djava.security.policy=all.policy</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个例子演示了在端口2020上用外部RMI注册服务器启动jstatd。</span></span><br><span class="line">rmiregistry 2020&amp;</span><br><span class="line">jstatd -J-Djava.security.policy=all.policy -p 2020</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个例子演示了在端口2020上用一个外部RMI注册表启动jstatd，绑定到名为AlternateJstatdServerName。</span></span><br><span class="line">rmiregistry 2020&amp;</span><br><span class="line">jstatd -J-Djava.security.policy=all.policy -p 2020 -n AlternateJstatdServerName</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个例子演示了如何启动jstatd，如果没有找到RMI注册表，它就不会创建RMI注册表。这个例子假设RMI注册表已经在运行。如果不是，则会发出适当的错误消息。</span></span><br><span class="line">jstatd -J-Djava.security.policy=all.policy -nr</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这个例子演示了在启用RMI日志功能的情况下启动jstatd。这项技术有助于故障排除或监控服务器活动</span></span><br><span class="line">jstatd -J-Djava.security.policy=all.policy -J-Djava.rmi.server.logCalls=true</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/14/linux/limit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/14/linux/limit/" class="post-title-link" itemprop="url">Linux limit</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-14 11:47:51" itemprop="dateCreated datePublished" datetime="2022-07-14T11:47:51+08:00">2022-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tc/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Linux-limit-系统资源限制相关配置信息及其含义介绍"><a href="#Linux-limit-系统资源限制相关配置信息及其含义介绍" class="headerlink" title="Linux limit 系统资源限制相关配置信息及其含义介绍"></a>Linux limit 系统资源限制相关配置信息及其含义介绍</h1><h2 id="资源限制范围"><a href="#资源限制范围" class="headerlink" title="资源限制范围"></a>资源限制范围</h2><p>资源限制分为系统级别和用户界别</p>
<ol>
<li><p>/etc/sysctl.conf 文件用于设置系统范围的资源限制</p>
</li>
<li><p>/etc/security/limits.conf 为 Oracle、MariaDB 和 Apache 等特定用户设置资源限制</p>
</li>
</ol>
<h2 id="sysctl-介绍"><a href="#sysctl-介绍" class="headerlink" title="sysctl 介绍"></a>sysctl 介绍</h2><p>sysctl 用来设置系统的核心参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-a 显示当前所有设置</span><br><span class="line">-A 以表格的形式显示</span><br><span class="line">-e 模糊模式</span><br><span class="line">-n 忽略关键词</span><br><span class="line">-w 设置变量值</span><br><span class="line">-p&lt;文件&gt; 指定配置文件</span><br><span class="line">-h 显示帮助信息</span><br><span class="line">-V 版本信息  </span><br></pre></td></tr></table></figure>

<p><em>sysctl -a   #显示系统核心设置</em></p>
<p><em>sysctl -w net.ipv4.tcp_max_syn_backlog=256 #设置环境变量</em></p>
<p><em>sysctl -p   #立马生效</em></p>
<h2 id="1-系统级别限制配置"><a href="#1-系统级别限制配置" class="headerlink" title="1. 系统级别限制配置"></a>1. 系统级别限制配置</h2><ul>
<li> 下次重启之前有效 修改系统级限制配置</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w fs.file-max=100000</span><br></pre></td></tr></table></figure>

<ul>
<li>无需注销和重新启动配置 修改系统级别限制配置</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">fs.file-max = 100000                       #最大打开文件数</span><br><span class="line">fs.file-nr = 2080       0       1621092    #文件描述符数量</span><br><span class="line"></span><br><span class="line">sysctl -p #使上述更改立即生效</span><br><span class="line"></span><br><span class="line">cat /proc/sys/fs/file-max #验证新的更改是否生效</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或者</span></span><br><span class="line">sysctl -a|grep file</span><br></pre></td></tr></table></figure>
<ul>
<li>查看系统相关配置<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat  /proc/sys/fs/file-nr #系统打开文件数描述符限制</span><br><span class="line"></span><br><span class="line">cat /proc/sys/fs/file-max #系统打开文件数限制</span><br><span class="line"></span><br><span class="line">sysctl -a|grep file</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-用户及系统限制"><a href="#2-用户及系统限制" class="headerlink" title="2. 用户及系统限制"></a>2. 用户及系统限制</h2><ul>
<li>ulimit指令 控制shell程序的资源</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> -a 　显示目前资源限制的设定。 </span><br><span class="line">  -c  　设定core文件的最大值，单位为区块。 </span><br><span class="line">  -d &lt;数据节区大小&gt; 　程序数据节区的最大值，单位为KB。 </span><br><span class="line">  -f &lt;文件大小&gt; 　shell所能建立的最大文件，单位为区块。 </span><br><span class="line">  -H 　设定资源的硬性限制，也就是管理员所设下的限制。 </span><br><span class="line">  -m &lt;内存大小&gt; 　指定可使用内存的上限，单位为KB。 </span><br><span class="line">  -n &lt;文件数目&gt; 　指定同一时间最多可开启的文件数。 </span><br><span class="line">  -p &lt;缓冲区大小&gt; 　指定管道缓冲区的大小，单位512字节。 </span><br><span class="line">  -s &lt;堆叠大小&gt; 　指定线程栈大小的上限，单位为KB。 </span><br><span class="line"></span><br><span class="line">  -S 　设定资源的弹性限制。 </span><br><span class="line"></span><br><span class="line">  -t  　指定CPU使用时间的上限，单位为秒。 </span><br><span class="line">  -u &lt;程序数目&gt; 　用户最多可开启的程序数目。 </span><br><span class="line">  -v &lt;虚拟内存大小&gt; 　指定可使用的虚拟内存上限，单位为KB。</span><br><span class="line"></span><br><span class="line">ulimit -n –&gt; 显示打开文件数限制</span><br><span class="line">ulimit -c –&gt; 显示核心转储文件大小</span><br><span class="line">umilit -u –&gt; 显示登录用户的最大用户进程数限制</span><br><span class="line">ulimit -f –&gt; 显示用户可以拥有的最大文件大小</span><br><span class="line">umilit -m –&gt; 显示登录用户的最大内存大小</span><br><span class="line">ulimit -v –&gt; 显示最大内存大小限制</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">ulimit -a                    #显示系统资源的设置</span><br><span class="line"></span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 3846</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 1024</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 3846</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ulimit -u 65525				 #设置单一用户程序数目上限</span><br><span class="line"></span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 3846</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 1024</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 65525		   #已改变</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>检查登录用户打开文件数量的硬限制和软限制</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shashi@Ubuntu ~&#125;$ ulimit -Hn</span><br><span class="line">1048576</span><br><span class="line">shashi@Ubuntu ~&#125;$ ulimit -Sn</span><br><span class="line">1024</span><br></pre></td></tr></table></figure>

<ul>
<li>设置用户级资源限制</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hard <span class="built_in">limit</span> <span class="keyword">for</span> max opened files <span class="keyword">for</span> linuxtechi user</span></span><br><span class="line">linuxtechi       hard    nofile          4096</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">soft <span class="built_in">limit</span> <span class="keyword">for</span> max opened files <span class="keyword">for</span> linuxtechi user</span></span><br><span class="line">linuxtechi       soft    nofile          1024</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hard <span class="built_in">limit</span> <span class="keyword">for</span> max number of process <span class="keyword">for</span> oracle user</span></span><br><span class="line">oracle           hard    nproc          8096</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">soft <span class="built_in">limit</span> <span class="keyword">for</span> max number of process <span class="keyword">for</span> oracle user</span></span><br><span class="line">oracle           soft    nproc          4096</span><br></pre></td></tr></table></figure>

<ul>
<li>设置用户组级资源限制</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hard <span class="built_in">limit</span> <span class="keyword">for</span> max opened files <span class="keyword">for</span> sysadmin group</span></span><br><span class="line">@sysadmin        hard         nofile            4096 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">soft <span class="built_in">limit</span> <span class="keyword">for</span> max opened files <span class="keyword">for</span> sysadmin group</span></span><br><span class="line">@sysadmin        soft         nofile            1024</span><br></pre></td></tr></table></figure>


<ul>
<li>切换用户并验证配置</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">su - linuxtechi</span><br><span class="line"></span><br><span class="line">ulimit -n -H #打开文件最大限制数硬限制</span><br><span class="line">4096</span><br><span class="line"></span><br><span class="line">ulimit -n -S #打开文件最大限制数软限制</span><br><span class="line">1024</span><br><span class="line"></span><br><span class="line">su - oracle</span><br><span class="line"></span><br><span class="line">ulimit -H -u #最大线程数</span><br><span class="line">8096</span><br><span class="line"></span><br><span class="line">ulimit -S -u #最大线程数</span><br><span class="line">4096</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>使配置生效到配置用户</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># /etc/security/limits.conf</span><br><span class="line">#</span><br><span class="line">#Each line describes a limit for a user in the form:</span><br><span class="line">#</span><br><span class="line">#&lt;domain&gt;        &lt;type&gt;  &lt;item&gt;  &lt;value&gt;</span><br><span class="line">#</span><br><span class="line">#Where:</span><br><span class="line">#&lt;domain&gt; can be:</span><br><span class="line">#        - an user name</span><br><span class="line">#        - a group name, with @group syntax</span><br><span class="line">#        - the wildcard *, for default entry</span><br><span class="line">#        - the wildcard %, can be also used with %group syntax,</span><br><span class="line">#                 for maxlogin limit</span><br><span class="line">#</span><br><span class="line">#&lt;type&gt; can have the two values:</span><br><span class="line">#        - &quot;soft&quot; for enforcing the soft limits  软限制(soft limit) 设定资源的软限制。警告的设定，可以超过这个设定值，但是若超过则有警告信息</span><br><span class="line">#        - &quot;hard&quot; for enforcing hard limits      硬限制(hard limit) 设定资源的硬性限制，也就是管理员所设下的限制。严格的设定，必定不能超过这个设定的数值</span><br><span class="line">#</span><br><span class="line">#&lt;item&gt; can be one of the following:</span><br><span class="line">#        - core - limits the core file size (KB) core文件其实就是内存的映像，当程序崩溃时，存储内存的相应信息，主用用于对程序进行调试。当程序崩溃时便会产生core文件，其实准确的应该说是core dump 文件,默认生成位置与可执行程序位于同一目录下，文件名为core.***,其中***是某一数字。</span><br><span class="line">#        - data - max data size (KB)</span><br><span class="line">#        - fsize - maximum filesize (KB)  所能建立的最大文件，单位为区块。</span><br><span class="line">#        - memlock - max locked-in-memory address space (KB)</span><br><span class="line">#        - nofile - max number of open files  指定同一时间最多可开启的文件数。</span><br><span class="line">#        - rss - max resident set size (KB)</span><br><span class="line">#        - stack - max stack size (KB)</span><br><span class="line">#        - cpu - max CPU time (MIN)</span><br><span class="line">#        - nproc - max number of processes  程序孵出的最大子进程数量 </span><br><span class="line">#        - as - address space limit (KB)  地址空间限制  进程可用的内存的最大数量，包括堆栈、全局变量、动态内存</span><br><span class="line">#        - maxlogins - max number of logins for this user 此用户允许登录的最大数目</span><br><span class="line">#        - maxsyslogins - max number of logins on the system 系统最大同时在线用户数</span><br><span class="line">#        - priority - the priority to run user process with 运行用户进程的优先级</span><br><span class="line">#        - locks - max number of file locks the user can hold 用户可以持有的文件锁的最大数量</span><br><span class="line">#        - sigpending - max number of pending signals</span><br><span class="line">#        - msgqueue - max memory used by POSIX message queues (bytes)</span><br><span class="line">#        - nice - max nice priority allowed to raise to values: [-20, 19]</span><br><span class="line">#        - rtprio - max realtime priority</span><br><span class="line">#</span><br><span class="line">#&lt;domain&gt;      &lt;type&gt;  &lt;item&gt;         &lt;value&gt;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/13/java/tomcat/tomcat_die/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/13/java/tomcat/tomcat_die/" class="post-title-link" itemprop="url">一次tomcat假死问题排查</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-13 10:00:34" itemprop="dateCreated datePublished" datetime="2022-07-13T10:00:34+08:00">2022-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tc/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>#Tomcat 假死问题排查思路</p>
<h3 id="Jvm内存问题及线程问题排查"><a href="#Jvm内存问题及线程问题排查" class="headerlink" title="Jvm内存问题及线程问题排查"></a>Jvm内存问题及线程问题排查</h3><ol>
<li>JVM内存使用情况查看 </li>
</ol>
<blockquote>
<p>jmap -heap pid</p>
</blockquote>
<blockquote>
<p>jmap -dump:live,format=b,file=/home/xxxx.hprof pid</p>
</blockquote>
<blockquote>
<p>jmap -histo:live 27151</p>
</blockquote>
<blockquote>
<p>jmap -histo 18230 | sort -n -r -k 2 | head -10  //统计实例最多的类 前十位有哪些</p>
</blockquote>
<blockquote>
<p>jmap -histo 18230 | sort -n -r -k 3 | head -10  //统计合计容量前十的类有哪些  </p>
</blockquote>
<blockquote>
<p>jstat -gcutil pid 1000 3 //监控gc 状态</p>
</blockquote>
<blockquote>
<p>jinfo -flags pid // 查看tomcatJVM配置参数</p>
</blockquote>
<ol start="2">
<li>线程栈问题提取 检查是否有锁问题</li>
</ol>
<blockquote>
<p>./jstack pid |grep http-nio-8090-exec （请求处理线程，可以检查处理线程卡在了哪里）<br>./jstack -l pid</p>
<blockquote>
<p>打印关于锁的其他信息，比如拥有的java.util.concurrent ownable同步器的列表。</p>
</blockquote>
</blockquote>
<blockquote>
<p>jstack -F pid</p>
<blockquote>
<p>当 jstack [-l] pid 没有响应时，强制打印一个堆栈转储。</p>
</blockquote>
</blockquote>
<ol start="3">
<li>查看tomcat进程内线程</li>
</ol>
<blockquote>
<p>ps -Lf –pid 16139 |wc -l</p>
<blockquote>
<p> 统计该tomcat进程内的线程个数 </p>
</blockquote>
</blockquote>
<blockquote>
<p>pstree -p 16139 |wc -l</p>
<blockquote>
<p>统计该tomcat进程内的线程个数 </p>
</blockquote>
</blockquote>
<ol start="4">
<li>查看进程打开的TCP链接的连接数</li>
</ol>
<blockquote>
<p>netstat -anpt|grep pid  -c</p>
</blockquote>
<ol start="5">
<li>查看端口的TCP连接数</li>
</ol>
<blockquote>
<p>  netstat -anpt|grep port -c</p>
</blockquote>
<h3 id="Tomcat相关配置"><a href="#Tomcat相关配置" class="headerlink" title="Tomcat相关配置"></a>Tomcat相关配置</h3><ol>
<li>catalina.sh 相关配置</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">JAVA_OPTS</span>=<span class="string">&quot;-server </span></span><br><span class="line"><span class="attr">-Dfile.encoding</span>=<span class="string">UTF-8 </span></span><br><span class="line"><span class="attr">-Xms2048m</span> <span class="string"></span></span><br><span class="line"><span class="attr">-Xmx2048m</span></span><br><span class="line"><span class="attr">-Xloggc</span>:<span class="string">/home/tomcat/images/gclogs/cms-gc-150.log</span></span><br><span class="line"><span class="attr">-verbose</span>:<span class="string">gc -XX:+PrintGCDetails</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">+PrintGCDateStamps</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">+UseGCLogFileRotation</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">+PrintGCApplicationStoppedTime</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">NumberOfGCLogFiles=10</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">GCLogFileSize=100M</span></span><br><span class="line"><span class="attr">-Dlog4j2.formatMsgNoLookups</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">+UseConcMarkSweepGC</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">CMSInitiatingOccupancyFraction=75</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">+UseCMSInitiatingOccupancyOnly</span></span><br><span class="line"><span class="attr">&quot;</span></span><br></pre></td></tr></table></figure>


<ol start="2">
<li>垃圾回收器</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=<span class="number">75</span></span><br><span class="line">-XX:+UseCMSInitiatingOccupancyOnly </span><br></pre></td></tr></table></figure>

<p>-XX:+UseConcMarkSweepGC<br>表示年轻代使用 ParNew，老年代的用 CMS 垃圾回收器</p>
<p>-XX:CMSInitiatingOccupancyFraction=75 </p>
<p>由于 CMS 在执行过程中，用户线程还需要运行，那就需要保证有充足的内存空间供用户使用。<br>如果等到老年代空间快满了，再开启这个回收过程，用户线程可能会产生“Concurrent Mode Failure”的错误，这时会临时启用 Serial Old 收集器来重新进行老年代的垃圾收集，<br>这样停顿时间就很长了（STW）。这部分空间预留，一般在 30% 左右即可，那么能用的大概只有 70%。参数 -XX:CMSInitiatingOccupancyFraction 用来配置这个比例，但它首先必须配置 -XX:+UseCMSInitiatingOccupancyOnly 参数。</p>
<p>-XX:+UseCMSInitiatingOccupancyOnly</p>
<ol start="3">
<li>TomcatConnector</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://tomcat.apache.org/tomcat-7.0-doc/config/http.html#Introduction">官网介绍</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8081&quot;</span> </span></span><br><span class="line"><span class="tag">               <span class="attr">protocol</span>=<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">keepAliveTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">acceptorThreadCount</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">maxThreads</span>=<span class="string">&quot;360&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">maxConnections</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">acceptCount</span>=<span class="string">&quot;200&quot;</span>       </span></span><br><span class="line"><span class="tag">               <span class="attr">redirectPort</span>=<span class="string">&quot;8445&quot;</span> </span></span><br><span class="line"><span class="tag">               <span class="attr">URIEncoding</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
 <Connector port="8081" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8445" URIEncoding="UTF-8" />
</blockquote>
<ul>
<li> protocol：</li>
</ul>
<p><em>一：BIO org.apache.coyote.http11.Http11Protocol - blocking Java connector</em> <br/><br><br/><br>一个线程处理一个请求。缺点：并发量高时，线程数较多，浪费资源。<br/><br>Tomcat7或以下，在Linux系统中默认使用这种方式。</p>
<p><em>二：NIO  org.apache.coyote.http11.Http11NioProtocol - non blocking Java connector</em><br/><br><br/><br>利用Java的异步IO处理，可以通过少量的线程处理大量的请求。<br/><br>Tomcat8在Linux系统中默认使用这种方式。<br/><br>Tomcat7必须修改Connector配置来启动：<br/><br><Connector port="8080" protocol="org.apache.coyote.http11.Http11NioProtocol" connectionTimeout="20000" redirectPort="8443"/> </p>
<p><em>三：APR org.apache.coyote.http11.Http11AprProtocol - the APR/native connector.</em><br/><br><br/><br>即Apache Portable Runtime，从操作系统层面解决io阻塞问题。<br/><br>Tomcat7或Tomcat8在Win7或以上的系统中启动默认使用这种方式。<br/><br>Linux如果安装了apr和native，Tomcat直接启动就支持apr。（安装方法：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/nb-blog/p/5278502.html%EF%BC%89">http://www.cnblogs.com/nb-blog/p/5278502.html）</a></p>
<ul>
<li><p>URIEncoding：<br/><br>This specifies the character encoding used to decode the URI bytes, after %xx decoding the URL. If not specified, ISO-8859-1 will be used.</p>
</li>
<li><p>acceptorThreadCount：<br/><br>用于接受连接的线程数。在多CPU的机器上增加这个值，虽然你永远不会真的需要超过2。此外，对于许多非保持活动状态的连接，您可能也想增加该值。默认值为1。</p>
</li>
</ul>
<ul>
<li><p>connectionLinger<br/><br>此连接器使用的套接字在关闭时停留的秒数。默认值为-1，表示禁用套接字逗留</p>
</li>
<li><p>connectionUploadTimeout<br/><br>指定数据上载过程中使用的超时时间(以毫秒为单位)。这仅在disableUploadTimeout设置为false时生效</p>
</li>
<li><p>disableUploadTimeout<br/><br>该标志允许servlet容器在数据上传期间使用不同的、通常更长的连接超时。如果未指定，此属性将设置为true，从而禁用更长的超时</p>
</li>
<li><p>keepAliveTimeout<br/><br>此连接器在关闭连接之前等待另一个HTTP请求的毫秒数。默认值是使用为connectionTimeout属性设置的值。使用值-1表示没有(即无限)超时</p>
</li>
<li><p>maxConnections<br/><br>服务器在任何给定时间接受和处理的最大连接数。当达到这个数目时，服务器将接受，但不处理，一个进一步的连接。这个额外的连接将被阻塞，直到被处理的连接数低于最大连接数，<br>此时服务器将再次开始接受和处理新的连接。请注意，一旦达到限制，操作系统可能仍然会根据acceptCount设置接受连接。默认值因连接器类型而异。<br>对于BIO，默认值是maxThreads的值，除非使用了执行器，在这种情况下，默认值将是来自执行器的maxThreads的值。对于NIO，默认值为10000。对于APR/native，默认值为8192。<br>仅对于NIO，将该值设置为-1将禁用maxConnections功能，并且不会计算连接数。</p>
</li>
<li><p>maxThreads<br/><br>此连接器要创建的最大请求处理线程数，因此决定了可以处理的最大并发请求数。如果未指定，该属性将设置为200。如果一个执行器与这个连接器相关联，那么这个属性将被忽略，<br>因为连接器将使用执行器而不是内部线程池来执行任务。<br>注意，如果配置了executor，为该属性设置的任何值都将被正确记录，但它将被报告(例如通过JMX)为-1，以表明它未被使用。</p>
</li>
<li><p>acceptCount<br/><br>当所有可能的请求处理线程都在使用中时，传入连接请求的最大队列长度。队列已满时收到的任何请求都将被拒绝。默认值为100</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/05/softwareeng/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95%E5%AD%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/06/05/softwareeng/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95%E5%AD%A6/" class="post-title-link" itemprop="url">软件开发方法学</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-05 20:25:49" itemprop="dateCreated datePublished" datetime="2022-06-05T20:25:49+08:00">2022-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">软件工程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>(1)生命周期法。软件开发严格按系统调查与分析、系统设计、系统实现、系统调试、运行维护和废弃等阶段进行。这种方法要求系统说明书应准确地表达用户的要求，并且在以后阶段不会发生变化。<br>　　<br>生命周期法采用结构化系统分析与设计的思想，其突出优点是强调系统开发过程的整体性和全局性，避免了开发过程中的混乱状态。其主要缺陷是开发周期长，工作效率低，难以适应新型开发工具的发展，但其基本思想在其他开发方法仍然适用。<br>　　<br>(2)原型法。开发人员首先构造系统初步模型，运行这个模型并根据用户的要求不断修改、补充，直到取得一个用户完全满意的原型为止，最后实现系统。  </p>
<p>原型法的主要优点是开发周期短、见效快，可以边开发边使用，比较适合于管理体制和结构不稳定，需要经常变化的环境。其缺点是初始原型设计比较困难，容易陷入软件危机，对于大型复杂的应用系统一般不宜采用。<br>　　<br>(3)面向对象法。简称OO，其基本思想是：客观事物都是由对象组成的，对象具有属性和方法，属性反映对象的特征，方法则是改变属性的各种动作；对象之间的联系主要通过传递消息来实现；对象可以按属性归为类，类有一定的结构，而且可以有子类，对象与类之间的层次关系是通过继承来维持的。<br>　　<br>按照上述思想，OO方法分为四个阶段：系统调查和需求分析，解决系统干什么；面向对象分析，识别出对象及其行为、结构、属性和方法，简称OOA；面向对象设计，对分析结果进一步抽象、归类和整理，最终以范式的形式确定下来，简称OOD；面向对象编程，利用面向对象程序设计语言编制应用程序，简称OOP。  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/30/tool/opensslcommon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/30/tool/opensslcommon/" class="post-title-link" itemprop="url">OpenSSL命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-05-30 14:01:59" itemprop="dateCreated datePublished" datetime="2022-05-30T14:01:59+08:00">2022-05-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>查看ca证书的内容<br>openssl x509 -in ca.crt -noout -text</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/30/tool/opensslzqm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/30/tool/opensslzqm/" class="post-title-link" itemprop="url">自签名证书</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-05-30 13:36:38" itemprop="dateCreated datePublished" datetime="2022-05-30T13:36:38+08:00">2022-05-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Centos7-环境下生成自签名SSL证书的具体过程："><a href="#Centos7-环境下生成自签名SSL证书的具体过程：" class="headerlink" title="Centos7 环境下生成自签名SSL证书的具体过程："></a>Centos7 环境下生成自签名SSL证书的具体过程：</h1><ol>
<li><p>修改 openssl 配置文件<br>vi /etc/pki/tls/openssl.cnf<br>match 表示后续生成的子证书的对应项必须和创建根证书时填的值一样，否则报错。以下配置只规定子证书的 countryName 必须和根证书一致。<br>[policy_match] 段配置改成如下：<br>countryName = match<br>stateOrProvinceName = optional<br>organizationName = optional<br>organizationalUnitName = optional<br>commonName = supplied<br>emailAddress = optional</p>
</li>
<li><p>在服务器 pki 的 CA 目录下新建两个文件<br>cd /etc/pki/CA &amp;&amp; touch index.txt serial &amp;&amp; echo 01 &gt; serial</p>
</li>
<li><p>生成CA根证书密钥<br>cd /etc/pki/CA/ &amp;&amp; openssl genrsa -out private/cakey.pem 2048 &amp;&amp; chmod 400 private/cakey.pem</p>
</li>
<li><p>生成根证书（根据提示输入信息，除了 Country Name 选项需要记住的，后面的随便填）<br>openssl req -new -x509 -key private/cakey.pem -out cacert.pem</p>
</li>
<li><p>生成密钥文件<br>openssl genrsa -out nginx.key 2048</p>
</li>
<li><p>生成证书请求文件（CSR）:<br>A.根据提示输入信息，除了 Country Name 与前面根证书一致外，其他随便填写<br>B.Common Name 填写要保护的域名，比如：*.qhh.me<br>openssl req -new -key nginx.key -out nginx.csr</p>
</li>
<li><p>使用 openssl 签署 CSR 请求，生成证书<br>openssl ca -in nginx.csr -cert /etc/pki/CA/cacert.pem -keyfile /etc/pki/CA/private/cakey.pem -days 365 -out nginx.crt</p>
</li>
</ol>
<blockquote>
<p>参数项说明：</p>
</blockquote>
<ol>
<li>-in: CSR 请求文件</li>
<li>-cert: 用于签发的根 CA 证书</li>
<li>-keyfile: 根 CA 的私钥文件</li>
<li>-days: 生成的证书的有效天数</li>
<li>-out: 生成证书的文件名</li>
</ol>
<p>至此自签名证书生成完成，最终需要：nginx.key 和 nginx.crt<br>8. 配置Nginx使用自签名证书</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen  80;</span><br><span class="line">  server_name     domain;</span><br><span class="line">  return  301     https://$host$request_uri;  # 表示强制将http请求重定向到https端口</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen  443 ssl;</span><br><span class="line">    ssl_certificate       ssl/nginx.crt; # 前面生成的 crt 证书文件</span><br><span class="line">    ssl_certificate_key   ssl/nginx.key; # 前面生成的证书私钥</span><br><span class="line">    server_name     domain;</span><br><span class="line">    location / &#123;</span><br><span class="line">    root /var/www-html;</span><br><span class="line">    index  index.html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/28/java/zk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="二哥关羽">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="别来无恙">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 别来无恙">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/28/java/zk/" class="post-title-link" itemprop="url">zookeeper</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-05-28 10:29:19" itemprop="dateCreated datePublished" datetime="2022-05-28T10:29:19+08:00">2022-05-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-25 18:31:18" itemprop="dateModified" datetime="2023-11-25T18:31:18+08:00">2023-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">分布式</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ZK集群"><a href="#ZK集群" class="headerlink" title="ZK集群"></a>ZK集群</h1><h2 id="ZK相关配置"><a href="#ZK相关配置" class="headerlink" title="ZK相关配置"></a>ZK相关配置</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tickTime</span>=<span class="string">2000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dataDir</span>=<span class="string">/var/lib/zookeeper/data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dataLogDir</span>=<span class="string">/var/lib/zookeeper/datalog</span></span><br><span class="line"></span><br><span class="line"><span class="attr">clientPort</span>=<span class="string">2181</span></span><br><span class="line"></span><br><span class="line"><span class="attr">initLimit</span>=<span class="string">5</span></span><br><span class="line"></span><br><span class="line"><span class="attr">syncLimit</span>=<span class="string">2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">maxClientCnxns</span>=<span class="string">60</span></span><br><span class="line"></span><br><span class="line"><span class="attr">peerType</span>=<span class="string">observer  #observer配置</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#dataDir目录中新增myid文件，myid配置范围1-255，端口1leader进行通信和数据同步的端口，端口2位选举投票接口</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.1</span>=<span class="string">10.3.60.151:2888:3888</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.2</span>=<span class="string">10.3.60.152:2888:3888</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.3</span>=<span class="string">10.3.60.153:2888:3888</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.x</span>=<span class="string">host:port1:port2:observer #observer配置</span></span><br></pre></td></tr></table></figure>



<h2 id="ZK中Leader选举"><a href="#ZK中Leader选举" class="headerlink" title="ZK中Leader选举"></a>ZK中Leader选举</h2><p><strong>集群中节点角色</strong></p>
<table>
<thead>
<tr>
<th>角色</th>
<th>读写</th>
<th>选举</th>
<th>过半写</th>
</tr>
</thead>
<tbody><tr>
<td>Leader</td>
<td>负责客户端读写</td>
<td>参与leader选举</td>
<td>参与过半写成功</td>
</tr>
<tr>
<td>Follower</td>
<td>负责客户端读</td>
<td>参与leader选举</td>
<td>参与过半写成功</td>
</tr>
<tr>
<td>Observer</td>
<td>负责客户端读</td>
<td>不参与leader选举</td>
<td>不参与过半写成功</td>
</tr>
</tbody></table>
<blockquote>
<p>Observer 在不影响写性能的条件下，提升集群的读性能</p>
</blockquote>
<p><strong>相关属性：</strong></p>
<p>SID:服务编号，及dataDir目录下myid编号</p>
<p>ZXID：事务编号，改变zookeeper几圈状态的操作，数据节点创建及删除，数据变更，客户单建立链接，及链接失效等变更都会产生新的事务编号。一般情况先会选ZXID大的节点为Leader ,如果都一样会选择SID大的节点为Leader</p>
<p>QUORUM：过半计数器</p>
<p>EPOCH：每个leader的纪元，生成新的leader都会生成一个新的增长的纪元。</p>
<h2 id="脑裂问题"><a href="#脑裂问题" class="headerlink" title="脑裂问题"></a>脑裂问题</h2><p><strong>脑裂问题描述：</strong><br>对于一个集群，想要提高这个集群的可用性，通常会采用多机房部署，比如现在有一个由6台zkServer所组成的一个集群，部署在了两个机房：</p>
<img src="/2022/05/28/java/zk/zk1.png" class="" title="脑裂问题">

<p>&emsp;&emsp;正常情况下，此集群只会有一个Leader，那么如果机房之间的网络断了之后，两个机房内的zkServer还是可以相互通信的，如果不考虑过半机制，那么就会出现每个机房内部都将选出一个Leader。</p>
<img src="/2022/05/28/java/zk/zk2.png" class="" title="脑裂问题">

<p>&emsp;&emsp;这就相当于原本一个集群，被分成了两个集群，出现了两个”大脑”，这就是所谓的”脑裂”现象。对于这种情况，其实也可以看出来，原本应该是统一的一个集群对外提供服务的，现在变成了两个集群同时对外提供服务，如果过了一会，断了的网络突然联通了，那么此时就会出现问题了，两个集群刚刚都对外提供服务了，数据该怎么合并，数据冲突怎么解决等等问题。刚刚在说明脑裂场景时有一个前提条件就是没有考虑过半机制.所以实际上Zookeeper集群中是不会轻易出现脑裂问题的，原因在于过半机制.</p>
<img src="/2022/05/28/java/zk/zk3.png" class="" title="脑裂问题">

<p>&emsp;&emsp;zookeeper的过半机制（Quorums (法定人数) 方式）：在领导者选举的过程中，如果某台zkServer获得了超过半数的选票，则此zkServer就可以成为Leader了。举个简单的例子：如果现在集群中有5台zkServer，那么half=5/2=2，那么也就是说，领导者选举的过程中至少要有三台zkServer投了同一个zkServer，才会符合过半机制，才能选出来一个Leader。</p>
<blockquote>
<p>过半机制很好的杜绝了脑列的问题</p>
</blockquote>
<h2 id="ZK作为master选举脑裂导致数据一致性问题："><a href="#ZK作为master选举脑裂导致数据一致性问题：" class="headerlink" title="ZK作为master选举脑裂导致数据一致性问题："></a>ZK作为master选举脑裂导致数据一致性问题：</h2><p>&emsp;&emsp;kafka将数据以主题划分，并且每个主题可以有多个分片，每个分片可以有多个副本，在多个副本中需要选择出主副本和副本，有主副本完成数据的操作，副本分片完成数据同步。<br>那么当出现主副本与zk因为网络问题，导致zk认为主副本掉线，重新选举主副本，但是此时主副本没有死掉，所以导致了主副本的假死现象。<br>&emsp;&emsp;如果客户端还未完成副本列表切换，那么会导致数据写入假死的副本，而完成了切换的节点数会写入到新的主副本，那么就导致了数据不一致,<br>&emsp;&emsp;Epoch leader纪元或者版本号或者叫做leader周期，当产生新的Leader后纪元会随之增加，那么老的leader数据不会同步到新的集群范围内，通过Epoch来控制集群的数据不一致性，及通过集群状态的版本号</p>
<h2 id="过半机制"><a href="#过半机制" class="headerlink" title="过半机制:"></a>过半机制:</h2><p>&emsp;&emsp;过半机制很好的杜绝了脑列的问题,过半验证还提高了系统效率，在写操作或者投票过程中不需要所有节点都完成，只要过半就完成投票或者写操作。</p>
<p><strong>容忍度问题：容忍度为n,那么集群建议的部署节点为2N+1</strong></p>
<p>&emsp;&emsp;一般情况下我们建议集群部署的节点为奇数个节点。至于为什么最好为奇数个节点？这样是为了以最大容错服务器个数的条件下，能节省资源。比如，最大容错为2的情况下，对应的zookeeper服务数，奇数为5，而偶数为6，也就是6个zookeeper服务的情况下最多能宕掉2个服务，所以从节约资源的角度看，没必要部署6（偶数）个zookeeper服务节点</p>
<h2 id="ZK权限认证方式"><a href="#ZK权限认证方式" class="headerlink" title="ZK权限认证方式"></a>ZK权限认证方式</h2><p>ACL全称为Access Control List（访问控制列表），用于控制资源的访问权限,可以控制节点的读写操作,保证数据的安全性 。</p>
<p>ZooKeeper使用ACL来控制对其znode的防问。</p>
<p>Zookeeper ACL 权限设置分为 3 部分组成，分别是：权限模式（Scheme）、授权对象（ID）、权限信息（Permission）</p>
<p>基于scheme:id:permission的方式进行权限控制： scheme表示授权模式、id模式对应值、permission即具体的增删改权限位。</p>
<h3 id="权限模式（Scheme）"><a href="#权限模式（Scheme）" class="headerlink" title="权限模式（Scheme）"></a>权限模式（Scheme）</h3><table>
<thead>
<tr>
<th>方案</th>
<th>描述</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>world</td>
<td>开放模式，world表示全世界都可以访问（这是默认设置）</td>
<td></td>
</tr>
<tr>
<td>ip</td>
<td>ip模式，限定客户端IP防问</td>
<td></td>
</tr>
<tr>
<td>auth</td>
<td>用户密码认证模式，只有在会话中添加了认证才可以防问</td>
<td></td>
</tr>
<tr>
<td>digest</td>
<td>与auth类似，区别在于auth用明文密码，而digest 用sha-1+base64加密后的密码。在实际使用中digest 更常见。</td>
<td></td>
</tr>
<tr>
<td>super</td>
<td>管理员</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>范围验证 范围验证就是说 ZooKeeper 可以针对一个 IP 或者一段 IP 地址授予某种权限。我们可以让一个 IP 地址为“ip：192.168.11.123”的机器对服务器上的某个数据节点具有写入的权限。或者也可以通过“ip:192.168.0.1/24”给一段 IP 地址的机器赋权。</p>
</blockquote>
<h3 id="授权对象（ID）"><a href="#授权对象（ID）" class="headerlink" title="授权对象（ID）"></a>授权对象（ID）</h3><p>授权对象就是说我们要把权限赋予谁，而对应于 4 种不同的权限模式来说，</p>
<ol>
<li><p>如果我们 选择采用 IP 方式，使用的授权对象可以是一个 IP 地址或 IP 地址段</p>
</li>
<li><p>使用 Digest 或 Super 方式，则对应于一个用户名</p>
</li>
<li><p>World 模式，是授权系统中所有的用户</p>
</li>
</ol>
<h3 id="权限信息（Permission）"><a href="#权限信息（Permission）" class="headerlink" title="权限信息（Permission）"></a>权限信息（Permission）</h3><p>权限就是指我们可以在数据节点上执行的操作种类，如下所示：在 ZooKeeper 中已经定义好的权限有 5 种：</p>
<ul>
<li>数据节点（c: create）创建权限，授予权限的对象可以在数据节点下创建子节点；</li>
<li>数据节点（w: wirte）更新权限，授予权限的对象可以更新该数据节点；</li>
<li>数据节点（r: read）读取权限，授予权限的对象可以读取该节点的内容以及子节点的列表信息；</li>
<li>数据节点（d: delete）删除权限，授予权限的对象可以删除该数据节点的子节点；</li>
<li>数据节点（a: admin）管理者权限，授予权限的对象可以对该数据节点体进行 ACL 权限设置。</li>
</ul>
<h3 id="ACL相关命令"><a href="#ACL相关命令" class="headerlink" title="ACL相关命令"></a>ACL相关命令</h3><table><thead><tr><th style="text-align:left"><div><div class="table-header"><p>命令</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>使用方式</p></div></div></th><th style="text-align:left"><div><div class="table-header"><p>描述</p></div></div></th></tr></thead><tbody><tr><td style="text-align:left"><div><div class="table-cell"><p>getAcl</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>getAcl path</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>读取ACL权限</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>setAcl</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>setAcl path acl</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>设置ACL权限</p></div></div></td></tr><tr><td style="text-align:left"><div><div class="table-cell"><p>addauth</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>addauth scheme auth</p></div></div></td><td style="text-align:left"><div><div class="table-cell"><p>添加认证用户</p></div></div></td></tr></tbody></table>

<img src="/2022/05/28/java/zk/zk4.png" class="" title="ACL相关命令">

<h3 id="跳过ACL检测"><a href="#跳过ACL检测" class="headerlink" title="跳过ACL检测"></a>跳过ACL检测</h3><p>可以通过系统参数zookeeper.skipACL=yes进行配置，默认是no,可以配置为true, 则配置过的ACL将不再进行权限检测</p>
<p>zkServer.sh</p>
<img src="/2022/05/28/java/zk/zk.png" class="" title="ACL相关命令">

<h3 id="权限扩展体系"><a href="#权限扩展体系" class="headerlink" title="权限扩展体系"></a>权限扩展体系</h3><p><a target="_blank" rel="noopener" href="https://zookeeper.apache.org/doc/r3.8.0/zookeeperProgrammers.html#sc_ZooKeeperPluggableAuthentication"></a></p>
<p>1: zookeeper支持自定义权限扩展，只需要集成通用的标准接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthenticationProvider</span> &#123;</span><br><span class="line">    String <span class="title function_">getScheme</span><span class="params">()</span>;</span><br><span class="line">    KeeperException.Code <span class="title function_">handleAuthentication</span><span class="params">(ServerCnxn cnxn, <span class="type">byte</span> authData[])</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String id)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(String id, String aclExpr)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAuthenticated</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2: 插件配置 (两种方式只有一个起作用)<br>方式1 系统变量</p>
<p>-Dzookeeeper.authProvider.X=com.f.MyAuth</p>
<p>方式2 配置文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">authProvider.1</span>=<span class="string">com.f.MyAuth</span></span><br><span class="line"><span class="attr">authProvider.2</span>=<span class="string">com.f.MyAuth2</span></span><br></pre></td></tr></table></figure>

<h2 id="实操ACL"><a href="#实操ACL" class="headerlink" title="实操ACL"></a>实操ACL</h2><h3 id="生成授权ID"><a href="#生成授权ID" class="headerlink" title="生成授权ID"></a>生成授权ID</h3><ul>
<li>方式一 Code<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateSuperDigest</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchAlgorithmException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sId</span> <span class="operator">=</span> DigestAuthenticationProvider.generateDigest(<span class="string">&quot;artisan:xgj&quot;</span>);</span><br><span class="line">    System.out.println(sId); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>方式二 shell命令<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -n &lt;user&gt;:&lt;password&gt; | openssl dgst -binary -sha1 | openssl base64</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost bin]# echo -n artisan:xgj | openssl dgst -binary -sha1 | openssl base64</span><br><span class="line">Xe7+HMYId2eNV48821ZrcFwIqIE=</span><br><span class="line">[root@localhost bin]# </span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="方式一-digest-密文授权"><a href="#方式一-digest-密文授权" class="headerlink" title="方式一 digest 密文授权"></a>方式一 digest 密文授权</h3><p>创建Node的时候 设置acl</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 10] create /artisan_node artisan_value digest:artisan:Xe7+HMYId2eNV48821ZrcFwIqIE=:cdrwa</span><br><span class="line">Created /artisan_node</span><br><span class="line">[zk: localhost:2181(CONNECTED) 11] get /artisan_node  # 直接查看没有访问权限的 </span><br><span class="line">org.apache.zookeeper.KeeperException$NoAuthException: KeeperErrorCode = NoAuth for /artisan_node</span><br><span class="line">[zk: localhost:2181(CONNECTED) 12] </span><br></pre></td></tr></table></figure>
<p>创建node的时候不指定acl ,然后用setAcl 设置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setAcl /artisan_node digest:artisan:Xe7+HMYId2eNV48821ZrcFwIqIE=:cdrwa</span><br></pre></td></tr></table></figure>
<p>如何才能有访问权限呢？ 因为是给artisan这个用户赋权的<br>【访问前需要添加授权信息】addauth</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 12] addauth digest artisan:xgj</span><br><span class="line">[zk: localhost:2181(CONNECTED) 13] get /artisan_node</span><br><span class="line">artisan_value</span><br><span class="line">[zk: localhost:2181(CONNECTED) 14] </span><br></pre></td></tr></table></figure>
<h3 id="方式二-auth-明文授权"><a href="#方式二-auth-明文授权" class="headerlink" title="方式二 auth 明文授权"></a>方式二 auth 明文授权</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 14] addauth digest aaa:passwddd</span><br><span class="line">[zk: localhost:2181(CONNECTED) 15] create /artisanNNN  nodeValue auth:aaa:passwddd:cdwra   # 这是aaa用户授权信息会被zk保存，可以认为当前的授权用户为aaa</span><br><span class="line">Created /artisanNNN</span><br><span class="line">[zk: localhost:2181(CONNECTED) 16] get /artisanNNN</span><br><span class="line">nodeValue</span><br><span class="line">[zk: localhost:2181(CONNECTED) 17] </span><br></pre></td></tr></table></figure>
<h3 id="方式三-IP授权模式"><a href="#方式三-IP授权模式" class="headerlink" title="方式三 IP授权模式"></a>方式三 IP授权模式</h3><p>创建时设置ip的权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create /node-ip  data  ip:192.168.11.123:cdwra</span><br></pre></td></tr></table></figure>
<p>或者创建完成以后 手工调用setAcl</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setAcl /node-ip ip:192.168.11.123:cdwra</span><br></pre></td></tr></table></figure>
<h3 id="方式四-Super-超级管理员模式"><a href="#方式四-Super-超级管理员模式" class="headerlink" title="方式四 Super 超级管理员模式"></a>方式四 Super 超级管理员模式</h3><p>是一种特殊的Digest模式， 在Super模式下超级管理员用户可以对Zookeeper上的节点进行任何的操作.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dzookeeper.DigestAuthenticationProvider.superDigest=super:&lt;base64encoded(SHA1(password))</span><br></pre></td></tr></table></figure>

<img src="/2022/05/28/java/zk/zk5.png" class="">

<h2 id="Zookeeper应用场景"><a href="#Zookeeper应用场景" class="headerlink" title="Zookeeper应用场景"></a>Zookeeper应用场景</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">二哥关羽</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
